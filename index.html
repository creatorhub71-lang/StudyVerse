<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyVerse - Advanced Learning Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4338ca;
            --primary-dark: #3730a3;
            --secondary: #7c3aed;
            --accent: #f59e0b;
            --light: #f8fafc;
            --dark: #1e293b;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
        }

        body {
            font-family: 'Inter', sans-serif;
        }

        .scrollbar-thin::-webkit-scrollbar {
            width: 4px;
            height: 4px;
        }

        .scrollbar-thin::-webkit-scrollbar-thumb {
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
        }

        .scrollbar-thin::-webkit-scrollbar-track {
            background-color: transparent;
        }

        .custom-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .custom-transition {
            transition: all 0.3s ease;
        }

        .custom-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        /* Fix for mobile menu */
        @media (max-width: 767px) {
            .md\:hidden {
                display: none;
            }
            .md\:flex {
                display: flex;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Main App Container -->
    <div id="app" class="min-h-screen flex flex-col">
        <!-- Navigation -->
        <nav id="main-nav" class="bg-white shadow-sm sticky top-0 z-50 hidden">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <div class="flex items-center">
                        <div class="flex-shrink-0 flex items-center">
                            <img class="block h-8 w-auto" src="https://tailwindui.com/img/logos/workflow-mark-indigo-600.svg" alt="StudyVerse">
                            <span class="ml-2 text-xl font-bold text-gray-900">StudyVerse</span>
                        </div>
                        <div class="hidden sm:ml-6 sm:flex sm:space-x-8" id="nav-links">
                            <!-- Navigation links will be added dynamically -->
                        </div>
                    </div>
                    <div class="hidden sm:ml-6 sm:flex sm:items-center">
                        <button id="user-menu-button" type="button" class="max-w-xs bg-white flex items-center text-sm rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" aria-expanded="false" aria-haspopup="true">
                            <span class="sr-only">Open user menu</span>
                            <img id="user-avatar" class="h-8 w-8 rounded-full" src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80" alt="">
                        </button>
                    </div>
                    <!-- Mobile menu button -->
                    <div class="-mr-2 flex items-center sm:hidden">
                        <button id="mobile-menu-button" type="button" class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500">
                            <span class="sr-only">Open main menu</span>
                            <svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Mobile menu -->
            <div id="mobile-menu" class="sm:hidden hidden">
                <div class="pt-2 pb-3 space-y-1">
                    <!-- Mobile menu items will be added dynamically -->
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="flex-grow">
            <!-- Landing Page -->
            <div id="landing-page" class="relative overflow-hidden">
                <div class="max-w-7xl mx-auto">
                    <div class="relative z-10 pb-8 bg-white sm:pb-16 md:pb-20 lg:max-w-2xl lg:w-full lg:pb-28 xl:pb-32">
                        <svg class="hidden lg:block absolute right-0 inset-y-0 h-full w-48 text-white transform translate-x-1/2" fill="currentColor" viewBox="0 0 100 100" preserveAspectRatio="none" aria-hidden="true">
                            <polygon points="50,0 100,0 50,100 0,100" />
                        </svg>

                        <div class="relative pt-6 px-4 sm:px-6 lg:px-8">
                            <nav class="relative flex items-center justify-between sm:h-10 lg:justify-start">
                                <div class="flex items-center flex-grow flex-shrink-0 lg:flex-grow-0">
                                    <div class="flex items-center justify-between w-full md:w-auto">
                                        <a href="#">
                                            <span class="sr-only">StudyVerse</span>
                                            <img class="h-8 w-auto sm:h-10" src="https://tailwindui.com/img/logos/workflow-mark-indigo-600.svg" alt="">
                                        </a>
                                        <div class="-mr-2 flex items-center md:hidden">
                                            <button type="button" class="bg-white rounded-md p-2 inline-flex items-center justify-center text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500" aria-expanded="false">
                                                <span class="sr-only">Open main menu</span>
                                                <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                                                </svg>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="hidden md:block md:ml-10 md:pr-4 md:space-x-8">
                                    <a href="#" class="font-medium text-indigo-600 hover:text-indigo-500">Log in</a>
                                    <a href="#" class="font-medium text-indigo-600 hover:text-indigo-500">Sign up</a>
                                </div>
                            </nav>
                        </div>

                        <div class="mt-10 mx-auto max-w-screen-xl px-4 sm:mt-12 sm:px-6 md:mt-16 lg:mt-20 lg:px-8 xl:mt-28">
                            <div class="sm:text-center lg:text-left">
                                <h1 class="text-4xl tracking-tight font-extrabold text-gray-900 sm:text-5xl md:text-6xl">
                                    <span class="block xl:inline">Transform your</span>
                                    <span class="block text-indigo-600 xl:inline">learning experience</span>
                                </h1>
                                <p class="mt-3 text-base text-gray-500 sm:mt-5 sm:text-lg sm:max-w-xl sm:mx-auto md:mt-5 md:text-xl lg:mx-0">
                                    StudyVerse provides comprehensive study materials, interactive learning, and expert guidance to help you excel in your academic journey.
                                </p>
                                <div class="mt-5 sm:mt-8 sm:flex sm:justify-center lg:justify-start">
                                    <div class="rounded-md shadow">
                                        <a href="#" id="enroll-btn" class="w-full flex items-center justify-center px-8 py-3 border border-transparent text-base font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 md:py-4 md:text-lg md:px-10 custom-transition custom-hover">
                                            Get started
                                        </a>
                                    </div>
                                    <div class="mt-3 sm:mt-0 sm:ml-3">
                                        <a href="#" id="login-btn" class="w-full flex items-center justify-center px-8 py-3 border border-transparent text-base font-medium rounded-md text-indigo-700 bg-indigo-100 hover:bg-indigo-200 md:py-4 md:text-lg md:px-10 custom-transition custom-hover">
                                            Log in
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="relative">
                            <div class="absolute inset-x-0 bottom-0 h-1/2 bg-gray-100" />
                            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                                <div class="max-w-4xl mx-auto">
                                    <dl class="rounded-lg bg-white shadow-lg sm:grid sm:grid-cols-3">
                                        <div class="flex flex-col border-b border-gray-100 p-6 text-center sm:border-0 sm:border-r">
                                            <dt class="order-2 mt-2 text-lg leading-6 font-medium text-gray-500">Comprehensive Courses</dt>
                                            <dd class="order-1 text-5xl font-extrabold text-indigo-600">100+</dd>
                                        </div>
                                        <div class="flex flex-col border-t border-b border-gray-100 p-6 text-center sm:border-0 sm:border-l sm:border-r">
                                            <dt class="order-2 mt-2 text-lg leading-6 font-medium text-gray-500">Expert Instructors</dt>
                                            <dd class="order-1 text-5xl font-extrabold text-indigo-600">50+</dd>
                                        </div>
                                        <div class="flex flex-col border-t border-gray-100 p-6 text-center sm:border-0 sm:border-l">
                                            <dt class="order-2 mt-2 text-lg leading-6 font-medium text-gray-500">Happy Students</dt>
                                            <dd class="order-1 text-5xl font-extrabold text-indigo-600">10,000+</dd>
                                        </div>
                                    </dl>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="lg:absolute lg:inset-y-0 lg:right-0 lg:w-1/2">
                    <img class="h-56 w-full object-cover sm:h-72 md:h-96 lg:w-full lg:h-full" src="https://images.unsplash.com/photo-1551434678-e076c223a692?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=2850&q=80" alt="">
                </div>
            </div>

            <!-- User Dashboard -->
            <div id="user-dashboard" class="hidden">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                    <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">
                        <!-- Batches will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Admin Dashboard -->
            <div id="admin-dashboard" class="hidden">
                <div class="flex h-screen bg-gray-100">
                    <!-- Sidebar -->
                    <div class="hidden md:flex md:flex-shrink-0">
                        <div class="flex flex-col w-64 bg-white border-r border-gray-200 pt-5 pb-4">
                            <div class="flex items-center flex-shrink-0 px-4">
                                <img class="h-8 w-auto" src="https://tailwindui.com/img/logos/workflow-mark-indigo-600.svg" alt="StudyVerse">
                                <span class="ml-2 text-xl font-bold text-gray-900">Admin Panel</span>
                            </div>
                            <div class="mt-5 flex-grow flex flex-col">
                                <nav class="flex-1 px-2 space-y-1 bg-white" aria-label="Sidebar">
                                    <a id="admin-batches-tab" href="#" class="admin-tab bg-indigo-50 border-indigo-500 text-indigo-700 group flex items-center px-2 py-2 text-sm font-medium rounded-md">
                                        <svg class="text-indigo-500 mr-3 h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                                        </svg>
                                        Batches
                                    </a>
                                    <a id="admin-subjects-tab" href="#" class="admin-tab border-transparent text-gray-600 hover:bg-gray-50 hover:text-gray-900 group flex items-center px-2 py-2 text-sm font-medium rounded-md">
                                        <svg class="text-gray-400 group-hover:text-gray-500 mr-3 h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332-.477 4.5-1.253m0-13C13.168 5.477 14.754 5 16.5 5S19.832 5.477 21 6.253v13C19.832 18.477 18.247 18 16.5 18s-3.332-.477-4.5-1.253" />
                                        </svg>
                                        Subjects
                                    </a>
                                    <a id="admin-chapters-tab" href="#" class="admin-tab border-transparent text-gray-600 hover:bg-gray-50 hover:text-gray-900 group flex items-center px-2 py-2 text-sm font-medium rounded-md">
                                        <svg class="text-gray-400 group-hover:text-gray-500 mr-3 h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                                        </svg>
                                        Chapters
                                    </a>
                                    <a id="admin-resources-tab" href="#" class="admin-tab border-transparent text-gray-600 hover:bg-gray-50 hover:text-gray-900 group flex items-center px-2 py-2 text-sm font-medium rounded-md">
                                        <svg class="text-gray-400 group-hover:text-gray-500 mr-3 h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657 1.657a2 2 0 01-.328 2.815l-5.385 6.592M17 21v-2a4 4 0 00-4-4H9m1.343-8.657l2.657 2.657a2 2 0 002.815-.328l6.592-5.385" />
                                        </svg>
                                        Resources
                                    </a>
                                    <a id="admin-live-classes-tab" href="#" class="admin-tab border-transparent text-gray-600 hover:bg-gray-50 hover:text-gray-900 group flex items-center px-2 py-2 text-sm font-medium rounded-md">
                                        <svg class="text-gray-400 group-hover:text-gray-500 mr-3 h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
                                        </svg>
                                        Live Classes
                                    </a>
                                </nav>
                            </div>
                        </div>
                    </div>

                    <!-- Main Content -->
                    <div class="flex flex-col w-0 flex-1 overflow-hidden">
                        <div class="relative z-10 flex-shrink-0 flex h-16 bg-white shadow">
                            <button id="mobile-sidebar-toggle" class="px-4 border-r border-gray-200 text-gray-500 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500 md:hidden">
                                <span class="sr-only">Open sidebar</span>
                                <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                                </svg>
                            </button>
                            <div class="flex-1 px-4 flex justify-between">
                                <div class="flex-1 flex">
                                    <div class="w-full flex md:ml-0">
                                        <label for="admin-search" class="sr-only">Search</label>
                                        <div class="relative w-full text-gray-400 focus-within:text-gray-600">
                                            <div class="absolute inset-y-0 left-0 flex items-center pointer-events-none">
                                                <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                                    <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                                                </svg>
                                            </div>
                                            <input id="admin-search" class="block w-full h-full pl-8 pr-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="Search" type="search">
                                        </div>
                                    </div>
                                </div>
                                <div class="ml-4 flex items-center md:ml-6">
                                    <button class="bg-white p-1 rounded-full text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                        <span class="sr-only">View notifications</span>
                                        <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                                        </svg>
                                    </button>
                                    <div class="ml-3 relative">
                                        <div>
                                            <button id="admin-user-menu-button" type="button" class="max-w-xs bg-white flex items-center text-sm rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" id="user-menu-button" aria-expanded="false" aria-haspopup="true">
                                                <span class="sr-only">Open user menu</span>
                                                <img id="admin-user-avatar" class="h-8 w-8 rounded-full" src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80" alt="">
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <main class="flex-1 relative overflow-y-auto focus:outline-none" tabindex="0">
                            <!-- Batches Management -->
                            <div id="admin-batches-section" class="p-6 admin-section">
                                <div class="flex justify-between items-center mb-6">
                                    <h1 class="text-2xl font-bold text-gray-900">Batches Management</h1>
                                    <button id="add-batch-btn" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                        <svg class="-ml-1 mr-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                            <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
                                        </svg>
                                        Add Batch
                                    </button>
                                </div>

                                <div class="bg-white shadow overflow-hidden sm:rounded-md">
                                    <ul id="batches-list" class="divide-y divide-gray-200">
                                        <!-- Batches will be loaded here -->
                                    </ul>
                                </div>
                            </div>

                            <!-- Subjects Management -->
                            <div id="admin-subjects-section" class="p-6 admin-section hidden">
                                <div class="flex justify-between items-center mb-6">
                                    <h1 class="text-2xl font-bold text-gray-900">Subjects Management</h1>
                                    <div class="flex space-x-3">
                                        <select id="subject-batch-select" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                                            <option value="">Select Batch</option>
                                            <!-- Batches will be loaded here -->
                                        </select>
                                        <button id="add-subject-btn" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                            <svg class="-ml-1 mr-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                                <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
                                            </svg>
                                            Add Subject
                                        </button>
                                    </div>
                                </div>

                                <div class="bg-white shadow overflow-hidden sm:rounded-md">
                                    <ul id="subjects-admin-list" class="divide-y divide-gray-200">
                                        <!-- Subjects will be loaded here -->
                                    </ul>
                                </div>
                            </div>

                            <!-- Chapters Management -->
                            <div id="admin-chapters-section" class="p-6 admin-section hidden">
                                <div class="flex justify-between items-center mb-6">
                                    <h1 class="text-2xl font-bold text-gray-900">Chapters Management</h1>
                                    <div class="flex space-x-3">
                                        <select id="chapter-subject-select" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                                            <option value="">Select Subject</option>
                                            <!-- Subjects will be loaded here -->
                                        </select>
                                        <button id="add-chapter-btn" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                            <svg class="-ml-1 mr-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                                <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
                                            </svg>
                                            Add Chapter
                                        </button>
                                    </div>
                                </div>

                                <div class="bg-white shadow overflow-hidden sm:rounded-md">
                                    <ul id="chapters-admin-list" class="divide-y divide-gray-200">
                                        <!-- Chapters will be loaded here -->
                                    </ul>
                                </div>
                            </div>

                            <!-- Resources Management -->
                            <div id="admin-resources-section" class="p-6 admin-section hidden">
                                <div class="flex justify-between items-center mb-6">
                                    <h1 class="text-2xl font-bold text-gray-900">Resources Management</h1>
                                    <div class="flex space-x-3">
                                        <select id="resource-chapter-select" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                                            <option value="">Select Chapter</option>
                                            <!-- Chapters will be loaded here -->
                                        </select>
                                        <div class="flex space-x-2">
                                            <button id="add-lecture-btn" class="inline-flex items-center px-3 py-2 border border-transparent text-xs font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                                                <svg class="-ml-0.5 mr-1.5 h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                                    <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
                                                </svg>
                                                Lecture
                                            </button>
                                            <button id="add-dpp-btn" class="inline-flex items-center px-3 py-2 border border-transparent text-xs font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                                <svg class="-ml-0.5 mr-1.5 h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                                    <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
                                                </svg>
                                                DPP
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-white shadow overflow-hidden sm:rounded-md">
                                    <div class="px-4 py-5 sm:p-6">
                                        <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">Lecture Notes</h3>
                                        <ul id="lectures-admin-list" class="divide-y divide-gray-200 mb-6">
                                            <!-- Lectures will be loaded here -->
                                        </ul>

                                        <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">Daily Practice Problems (DPP)</h3>
                                        <ul id="dpps-admin-list" class="divide-y divide-gray-200">
                                            <!-- DPPs will be loaded here -->
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <!-- Live Classes Management -->
                            <div id="admin-live-classes-section" class="p-6 admin-section hidden">
                                <div class="flex justify-between items-center mb-6">
                                    <h1 class="text-2xl font-bold text-gray-900">Live Classes Management</h1>
                                    <div class="flex space-x-3">
                                        <select id="live-class-batch-select" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                                            <option value="">Select Batch</option>
                                            <!-- Batches will be loaded here -->
                                        </select>
                                        <button id="add-live-class-btn" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                            <svg class="-ml-1 mr-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                                <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
                                            </svg>
                                            Schedule Class
                                        </button>
                                    </div>
                                </div>

                                <div class="bg-white shadow overflow-hidden sm:rounded-md">
                                    <ul id="live-classes-admin-list" class="divide-y divide-gray-200">
                                        <!-- Live classes will be loaded here -->
                                    </ul>
                                </div>
                            </div>
                        </main>
                    </div>
                </div>
            </div>

            <!-- Profile Page -->
            <div id="profile-page" class="hidden">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                    <div class="bg-white shadow rounded-lg overflow-hidden">
                        <div class="px-4 py-5 sm:px-6">
                            <h3 class="text-lg leading-6 font-medium text-gray-900">User Profile</h3>
                            <p class="mt-1 max-w-2xl text-sm text-gray-500">Personal details and application.</p>
                        </div>
                        <div class="border-t border-gray-200">
                            <dl>
                                <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                    <dt class="text-sm font-medium text-gray-500">Full name</dt>
                                    <dd id="profile-name" class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2"></dd>
                                </div>
                                <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                    <dt class="text-sm font-medium text-gray-500">Email address</dt>
                                    <dd id="profile-email" class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2"></dd>
                                </div>
                                <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                    <dt class="text-sm font-medium text-gray-500">Phone number</dt>
                                    <dd id="profile-phone" class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2"></dd>
                                </div>
                                <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                    <dt class="text-sm font-medium text-gray-500">Role</dt>
                                    <dd id="profile-role" class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2"></dd>
                                </div>
                                <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                    <dt class="text-sm font-medium text-gray-500">Enrolled Batches</dt>
                                    <dd id="profile-batches" class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2"></dd>
                                </div>
                            </dl>
                        </div>
                    </div>

                    <div class="mt-6 bg-white shadow rounded-lg p-6">
                        <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">Update Profile</h3>
                        <form id="update-profile-form" class="space-y-6">
                            <div>
                                <label for="update-name" class="block text-sm font-medium text-gray-700">Full Name</label>
                                <div class="mt-1">
                                    <input id="update-name" name="name" type="text" class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md">
                                </div>
                            </div>
                            <div>
                                <label for="update-phone" class="block text-sm font-medium text-gray-700">Phone Number</label>
                                <div class="mt-1">
                                    <input id="update-phone" name="phone" type="text" class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md">
                                </div>
                            </div>
                            <div>
                                <label for="update-password" class="block text-sm font-medium text-gray-700">New Password (leave blank to keep current)</label>
                                <div class="mt-1">
                                    <input id="update-password" name="password" type="password" class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md">
                                </div>
                            </div>
                            <div class="flex justify-end">
                                <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                    Save changes
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Settings Page -->
            <div id="settings-page" class="hidden">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                    <div class="bg-white shadow rounded-lg p-6">
                        <h2 class="text-lg font-medium text-gray-900">Account Settings</h2>
                        <p class="mt-1 text-sm text-gray-500">Manage your account preferences</p>

                        <div class="mt-6">
                            <div class="divide-y divide-gray-200">
                                <div class="py-6">
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <h3 class="text-sm font-medium text-gray-900">Dark Mode</h3>
                                            <p class="mt-1 text-sm text-gray-500">Enable dark theme for better night viewing</p>
                                        </div>
                                        <button id="dark-mode-toggle" type="button" class="bg-indigo-600 relative inline-flex flex-shrink-0 h-6 w-11 border-2 border-transparent rounded-full cursor-pointer transition-colors ease-in-out duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" role="switch" aria-checked="false">
                                            <span class="sr-only">Use setting</span>
                                            <span aria-hidden="true" class="translate-x-0 inline-block h-5 w-5 rounded-full bg-white shadow transform ring-0 transition ease-in-out duration-200"></span>
                                        </button>
                                    </div>
                                </div>
                                <div class="py-6">
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <h3 class="text-sm font-medium text-gray-900">Email Notifications</h3>
                                            <p class="mt-1 text-sm text-gray-500">Receive email notifications for important updates</p>
                                        </div>
                                        <button id="email-notifications-toggle" type="button" class="bg-indigo-600 relative inline-flex flex-shrink-0 h-6 w-11 border-2 border-transparent rounded-full cursor-pointer transition-colors ease-in-out duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" role="switch" aria-checked="false">
                                            <span class="sr-only">Use setting</span>
                                            <span aria-hidden="true" class="translate-x-5 inline-block h-5 w-5 rounded-full bg-white shadow transform ring-0 transition ease-in-out duration-200"></span>
                                        </button>
                                    </div>
                                </div>
                                <div class="py-6">
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <h3 class="text-sm font-medium text-gray-900">Delete Account</h3>
                                            <p class="mt-1 text-sm text-gray-500">Permanently delete your account and all data</p>
                                        </div>
                                        <button id="delete-account-btn" type="button" class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                                            Delete
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="bg-white hidden">
            <div class="max-w-7xl mx-auto py-12 px-4 overflow-hidden sm:px-6 lg:px-8">
                <nav class="-mx-5 -my-2 flex flex-wrap" aria-label="Footer">
                    <div class="px-5 py-2">
                        <a href="#" class="text-base text-gray-500 hover:text-gray-900">About</a>
                    </div>
                    <div class="px-5 py-2">
                        <a href="#" class="text-base text-gray-500 hover:text-gray-900">Contact</a>
                    </div>
                    <div class="px-5 py-2">
                        <a href="#" class="text-base text-gray-500 hover:text-gray-900">Privacy</a>
                    </div>
                    <div class="px-5 py-2">
                        <a href="#" class="text-base text-gray-500 hover:text-gray-900">Terms</a>
                    </div>
                </nav>
                <p class="mt-8 text-center text-base text-gray-400">&copy; 2023 StudyVerse. All rights reserved.</p>
            </div>
        </footer>
    </div>

    <!-- Auth Modal -->
    <div id="auth-modal" class="fixed z-50 inset-0 overflow-y-auto hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>

            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>

            <div class="inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-sm sm:w-full sm:p-6">
                <div>
                    <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-indigo-100">
                        <svg class="h-6 w-6 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15l8-8V5a4 4 0 00-4-4H8a4 4 0 00-4 4v7z" />
                        </svg>
                    </div>
                    <div class="mt-3 text-center sm:mt-5">
                        <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">
                            Welcome to StudyVerse
                        </h3>
                        <div class="mt-2">
                            <p class="text-sm text-gray-500">
                                Sign in to access your account or create a new one to get started.
                            </p>
                        </div>
                    </div>
                </div>
                <div class="mt-5 sm:mt-6">
                    <div class="space-y-4">
                        <button id="google-signin-btn" class="w-full flex items-center justify-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            <svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 21 20">
                                <path fill="#4285f4" d="M20.64 10.2c-.2-.67-.97-1.08-1.58-1.08-.57 0-.98.37-1.16.87-.02.09-.03 3.43-.03 6.8 0 3.08.02 5.9-.03 6.8-.18.5-.59.87-1.16.87-1.24 0-2.2-.78-2.63-2.05.08-.2.14-.43.14-.7 0-.27-.11-.51-.31-.7-.74-.65-1.77-1.86-2.3-3.1-.21-.5-.51-.86-.9-.99H10c.01 1.01 0 1.77 0 1.77s-.01-.76 0-1.77H.97c-.39.13-.7.5-.9.99-.53 1.24-1.56 2.45-2.3 3.1-.2.19-.31.43-.31.7 0 .27.11.51.31.7.74.65 1.77 1.86 2.3 3.1.18.5.59.87 1.16.87.57 0 .98-.37 1.16-.87.18-.5.2-.97.2-1.42 0-.45-.02-.88-.03-1.3z"/>
                                <path fill="#34a853" d="M10.37 20c2.59-1.77 4.5-4.9 4.5-8.44 0-.45-.05-.89-.14-1.3H20c.09.45.14.9.14 1.3 0 3.54-1.91 6.67-4.64 8.44-1.2.7-2.65 1.06-4.14 1.06-1.49 0-2.84-.36-3.91-1.06z"/>
                                <path fill="#fbbc05" d="M5.52 11.56c-.2-.58-.32-1.2-.32-1.84 0-.64.12-1.25.37-1.77-.85-.25-1.77-.37-2.63-.37-.85 0-1.68.12-2.47.37-.57.25-1.05.6-1.39 1.06-.18.25-.29.57-.29.92 0 .35.11.68.32.92-.97.38-1.86.95-2.59 1.65-.2.25-.34.56-.34.9-.01.34.15.64.4.87.5.48 1.15.84 1.9.99.26-.65.38-1.37.38-2.14 0-.37-.12-.72-.34-1.02A3.9 3.9 0 01.97 7.28c.12-.3.28-.58.47-.8.85-1.1 2.06-1.79 3.45-1.79 1.39 0 2.6.69 3.45 1.79.19.22.35.5.47.8.29.29.48.65.48 1.02 0 .37-.12.72-.34 1.02.61.19 1.18.53 1.69.99.26.25.48.56.61.91.01.03 0 .07-.01.1-.04.74-.2 1.42-.45 2.05C4.75 18.1 2.14 19 0 19c-.26 0-.51-.1-.73-.29A7.02 7.02 0 01.6 15.2c-.01-.74.19-1.45.53-2.08L5.52 11.56z"/>
                                <path fill="#eb4335" d="M10.37 20c2.59-1.77 4.5-4.9 4.5-8.44 0-.45-.05-.89-.14-1.3H20c.09.45.14.9.14 1.3 0 3.54-1.91 6.67-4.64 8.44-1.2.7-2.65 1.06-4.14 1.06-1.49 0-2.84-.36-3.91-1.06zM0 19c.26 0 .51-.1.73-.29C1.91 17.26 3.52 15.2 5.52 11.56l-4.45-4.46c-.85.25-1.77.37-2.63.37-.85 0-1.68-.12-2.47-.37A7.03 7.03 0 00.6 7.28C.19 9.5 0 12.14 0 15c0 2.86.95 5.5 2.59 7.44.85.99 2.16 1.56 3.45 1.56z"/>
                            </svg>
                            Sign in with Google
                        </button>
                        <div class="relative">
                            <div class="absolute inset-0 flex items-center">
                                <div class="w-full border-t border-gray-300"></div>
                            </div>
                            <div class="relative flex justify-center text-sm">
                                <span class="px-2 bg-white text-gray-500">
                                    Or continue with
                                </span>
                            </div>
                        </div>
                        <form id="auth-form" class="space-y-4">
                            <div>
                                <label for="email" class="block text-sm font-medium text-gray-700">Email address</label>
                                <div class="mt-1">
                                    <input id="email" name="email" type="email" autocomplete="email" required class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                </div>
                            </div>
                            <div>
                                <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
                                <div class="mt-1">
                                    <input id="password" name="password" type="password" autocomplete="current-password" required class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <input id="remember-me" name="remember-me" type="checkbox" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                                    <label for="remember-me" class="ml-2 block text-sm text-gray-900">
                                        Remember me
                                    </label>
                                </div>
                                <div class="text-sm">
                                    <a href="#" class="font-medium text-indigo-600 hover:text-indigo-500">
                                        Forgot your password?
                                    </a>
                                </div>
                            </div>
                            <div>
                                <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                    Sign in
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Batch Modal -->
    <div id="batch-modal" class="fixed z-50 inset-0 overflow-y-auto hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6">
                <div>
                    <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-indigo-100">
                        <svg class="h-6 w-6 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                        </svg>
                    </div>
                    <div class="mt-3 text-center sm:mt-5">
                        <h3 id="batch-modal-title" class="text-lg leading-6 font-medium text-gray-900">Add New Batch</h3>
                        <div class="mt-2">
                            <p class="text-sm text-gray-500">
                                Create a new batch for students to enroll in.
                            </p>
                        </div>
                    </div>
                </div>
                <form id="batch-form" class="mt-5 sm:mt-6 space-y-4">
                    <input type="hidden" id="batch-id">
                    <div>
                        <label for="batch-name" class="block text-sm font-medium text-gray-700">Batch Name</label>
                        <div class="mt-1">
                            <input type="text" name="name" id="batch-name" required class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md">
                        </div>
                    </div>
                    <div>
                        <label for="batch-description" class="block text-sm font-medium text-gray-700">Description</label>
                        <div class="mt-1">
                            <textarea id="batch-description" name="description" rows="3" class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md"></textarea>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-2">
                        <div>
                            <label for="batch-start-date" class="block text-sm font-medium text-gray-700">Start Date</label>
                            <div class="mt-1">
                                <input type="date" name="startDate" id="batch-start-date" required class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md">
                            </div>
                        </div>
                        <div>
                            <label for="batch-duration" class="block text-sm font-medium text-gray-700">Duration (months)</label>
                            <div class="mt-1">
                                <input type="number" name="duration" id="batch-duration" min="1" required class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md">
                            </div>
                        </div>
                    </div>
                    <div>
                        <label for="batch-instructor" class="block text-sm font-medium text-gray-700">Instructor</label>
                        <div class="mt-1">
                            <input type="text" name="instructor" id="batch-instructor" required class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md">
                        </div>
                    </div>
                    <div>
                        <label for="batch-capacity" class="block text-sm font-medium text-gray-700">Capacity</label>
                        <div class="mt-1">
                            <input type="number" name="capacity" id="batch-capacity" min="1" required class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md">
                        </div>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" id="cancel-batch-btn" class="inline-flex justify-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            Cancel
                        </button>
                        <button type="submit" class="inline-flex justify-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            Save
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add/Edit Subject Modal -->
    <div id="subject-modal" class="fixed z-50 inset-0 overflow-y-auto hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6">
                <div>
                    <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-indigo-100">
                        <svg class="h-6 w-6 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332-.477 4.5-1.253m0-13C13.168 5.477 14.754 5 16.5 5S19.832 5.477 21 6.253v13C19.832 18.477 18.247 18 16.5 18s-3.332-.477-4.5-1.253" />
                        </svg>
                    </div>
                    <div class="mt-3 text-center sm:mt-5">
                        <h3 id="subject-modal-title" class="text-lg leading-6 font-medium text-gray-900">Add New Subject</h3>
                        <div class="mt-2">
                            <p class="text-sm text-gray-500">
                                Add a new subject to the selected batch.
                            </p>
                        </div>
                    </div>
                </div>
                <form id="subject-form" class="mt-5 sm:mt-6 space-y-4">
                    <input type="hidden" id="subject-id">
                    <input type="hidden" id="subject-batch-id">
                    <div>
                        <label for="subject-name" class="block text-sm font-medium text-gray-700">Subject Name</label>
                        <div class="mt-1">
                            <input type="text" name="name" id="subject-name" required class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-2">
                        <div>
                            <label for="subject-code" class="block text-sm font-medium text-gray-700">Subject Code</label>
                            <div class="mt-1">
                                <input type="text" name="code" id="subject-code" required class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md">
                            </div>
                        </div>
                        <div>
                            <label for="subject-credits" class="block text-sm font-medium text-gray-700">Credit Hours</label>
                            <div class="mt-1">
                                <input type="number" name="credits" id="subject-credits" min="1" required class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md">
                            </div>
                        </div>
                    </div>
                    <div>
                        <label for="subject-description" class="block text-sm font-medium text-gray-700">Description</label>
                        <div class="mt-1">
                            <textarea id="subject-description" name="description" rows="3" class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md"></textarea>
                        </div>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" id="cancel-subject-btn" class="inline-flex justify-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            Cancel
                        </button>
                        <button type="submit" class="inline-flex justify-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            Save
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add/Edit Chapter Modal -->
    <div id="chapter-modal" class="fixed z-50 inset-0 overflow-y-auto hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6">
                <div>
                    <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-indigo-100">
                        <svg class="h-6 w-6 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                        </svg>
                    </div>
                    <div class="mt-3 text-center sm:mt-5">
                        <h3 id="chapter-modal-title" class="text-lg leading-6 font-medium text-gray-900">Add New Chapter</h3>
                        <div class="mt-2">
                            <p class="text-sm text-gray-500">
                                Add a new chapter to the selected subject.
                            </p>
                        </div>
                    </div>
                </div>
                <form id="chapter-form" class="mt-5 sm:mt-6 space-y-4">
                    <input type="hidden" id="chapter-id">
                    <input type="hidden" id="chapter-subject-id">
                    <div>
                        <label for="chapter-title" class="block text-sm font-medium text-gray-700">Chapter Title</label>
                        <div class="mt-1">
                            <input type="text" name="title" id="chapter-title" required class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-2">
                        <div>
                            <label for="chapter-number" class="block text-sm font-medium text-gray-700">Chapter Number</label>
                            <div class="mt-1">
                                <input type="number" name="number" id="chapter-number" min="1" required class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md">
                            </div>
                        </div>
                        <div>
                            <label for="chapter-duration" class="block text-sm font-medium text-gray-700">Duration (hours)</label>
                            <div class="mt-1">
                                <input type="number" name="duration" id="chapter-duration" min="1" required class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md">
                            </div>
                        </div>
                    </div>
                    <div>
                        <label for="chapter-description" class="block text-sm font-medium text-gray-700">Description</label>
                        <div class="mt-1">
                            <textarea id="chapter-description" name="description" rows="3" class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md"></textarea>
                        </div>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" id="cancel-chapter-btn" class="inline-flex justify-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            Cancel
                        </button>
                        <button type="submit" class="inline-flex justify-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            Save
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add/Edit Lecture Modal -->
    <div id="lecture-modal" class="fixed z-50 inset-0 overflow-y-auto hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full sm:p-6">
                <div>
                    <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-indigo-100">
                        <svg class="h-6 w-6 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                    </div>
                    <div class="mt-3 text-center sm:mt-5">
                        <h3 id="lecture-modal-title" class="text-lg leading-6 font-medium text-gray-900">Add New Lecture Note</h3>
                        <div class="mt-2">
                            <p class="text-sm text-gray-500">
                                Add a new lecture note to the selected chapter.
                            </p>
                        </div>
                    </div>
                </div>
                <form id="lecture-form" class="mt-5 sm:mt-6 space-y-4">
                    <input type="hidden" id="lecture-id">
                    <input type="hidden" id="lecture-chapter-id">
                    <div>
                        <label for="lecture-title" class="block text-sm font-medium text-gray-700">Lecture Title</label>
                        <div class="mt-1">
                            <input type="text" name="title" id="lecture-title" required class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-2">
                        <div>
                            <label for="lecture-number" class="block text-sm font-medium text-gray-700">Lecture Number</label>
                            <div class="mt-1">
                                <input type="number" name="number" id="lecture-number" min="1" required class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md">
                            </div>
                        </div>
                        <div>
                            <label for="lecture-date" class="block text-sm font-medium text-gray-700">Date</label>
                            <div class="mt-1">
                                <input type="date" name="date" id="lecture-date" required class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md">
                            </div>
                        </div>
                    </div>
                    <div>
                        <label for="lecture-description" class="block text-sm font-medium text-gray-700">Description</label>
                        <div class="mt-1">
                            <textarea id="lecture-description" name="description" rows="3" class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md"></textarea>
                        </div>
                    </div>
                    <div>
                        <label for="lecture-content" class="block text-sm font-medium text-gray-700">Content (URL or HTML)</label>
                        <div class="mt-1">
                            <textarea id="lecture-content" name="content" rows="8" class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md" placeholder="Enter URL to PDF/Document or HTML content"></textarea>
                        </div>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" id="cancel-lecture-btn" class="inline-flex justify-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            Cancel
                        </button>
                        <button type="submit" class="inline-flex justify-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            Save
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add/Edit DPP Modal -->
    <div id="dpp-modal" class="fixed z-50 inset-0 overflow-y-auto hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full sm:p-6">
                <div>
                    <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-indigo-100">
                        <svg class="h-6 w-6 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
                        </svg>
                    </div>
                    <div class="mt-3 text-center sm:mt-5">
                        <h3 id="dpp-modal-title" class="text-lg leading-6 font-medium text-gray-900">Add New DPP</h3>
                        <div class="mt-2">
                            <p class="text-sm text-gray-500">
                                Add a new Daily Practice Problem to the selected chapter.
                            </p>
                        </div>
                    </div>
                </div>
                <form id="dpp-form" class="mt-5 sm:mt-6 space-y-4">
                    <input type="hidden" id="dpp-id">
                    <input type="hidden" id="dpp-chapter-id">
                    <div>
                        <label for="dpp-title" class="block text-sm font-medium text-gray-700">DPP Title</label>
                        <div class="mt-1">
                            <input type="text" name="title" id="dpp-title" required class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-2">
                        <div>
                            <label for="dpp-number" class="block text-sm font-medium text-gray-700">DPP Number</label>
                            <div class="mt-1">
                                <input type="number" name="number" id="dpp-number" min="1" required class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md">
                            </div>
                        </div>
                        <div>
                            <label for="dpp-date" class="block text-sm font-medium text-gray-700">Due Date</label>
                            <div class="mt-1">
                                <input type="date" name="dueDate" id="dpp-date" required class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md">
                            </div>
                        </div>
                    </div>
                    <div>
                        <label for="dpp-description" class="block text-sm font-medium text-gray-700">Description</label>
                        <div class="mt-1">
                            <textarea id="dpp-description" name="description" rows="3" class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md"></textarea>
                        </div>
                    </div>
                    <div>
                        <label for="dpp-content" class="block text-sm font-medium text-gray-700">Content (URL or HTML)</label>
                        <div class="mt-1">
                            <textarea id="dpp-content" name="content" rows="8" class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md" placeholder="Enter URL to PDF/Document or HTML content"></textarea>
                        </div>
                    </div>
                    <div>
                        <label for="dpp-solution" class="block text-sm font-medium text-gray-700">Solution (URL or HTML)</label>
                        <div class="mt-1">
                            <textarea id="dpp-solution" name="solution" rows="5" class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md" placeholder="Enter URL to solution PDF/Document or HTML content"></textarea>
                        </div>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" id="cancel-dpp-btn" class="inline-flex justify-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            Cancel
                        </button>
                        <button type="submit" class="inline-flex justify-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            Save
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add/Edit Live Class Modal -->
    <div id="live-class-modal" class="fixed z-50 inset-0 overflow-y-auto hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6">
                <div>
                    <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-indigo-100">
                        <svg class="h-6 w-6 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
                        </svg>
                    </div>
                    <div class="mt-3 text-center sm:mt-5">
                        <h3 id="live-class-modal-title" class="text-lg leading-6 font-medium text-gray-900">Schedule Live Class</h3>
                        <div class="mt-2">
                            <p class="text-sm text-gray-500">
                                Schedule a new live class for the selected batch.
                            </p>
                        </div>
                    </div>
                </div>
                <form id="live-class-form" class="mt-5 sm:mt-6 space-y-4">
                    <input type="hidden" id="live-class-id">
                    <input type="hidden" id="live-class-batch-id">
                    <div>
                        <label for="live-class-title" class="block text-sm font-medium text-gray-700">Class Title</label>
                        <div class="mt-1">
                            <input type="text" name="title" id="live-class-title" required class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-2">
                        <div>
                            <label for="live-class-date" class="block text-sm font-medium text-gray-700">Date</label>
                            <div class="mt-1">
                                <input type="date" name="date" id="live-class-date" required class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md">
                            </div>
                        </div>
                        <div>
                            <label for="live-class-time" class="block text-sm font-medium text-gray-700">Time</label>
                            <div class="mt-1">
                                <input type="time" name="time" id="live-class-time" required class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md">
                            </div>
                        </div>
                    </div>
                    <div>
                        <label for="live-class-duration" class="block text-sm font-medium text-gray-700">Duration (minutes)</label>
                        <div class="mt-1">
                            <input type="number" name="duration" id="live-class-duration" min="30" step="15" required class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md">
                        </div>
                    </div>
                    <div>
                        <label for="live-class-link" class="block text-sm font-medium text-gray-700">Meeting Link</label>
                        <div class="mt-1">
                            <input type="url" name="link" id="live-class-link" required class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md" placeholder="https://zoom.us/j/...">
                        </div>
                    </div>
                    <div>
                        <label for="live-class-description" class="block text-sm font-medium text-gray-700">Description</label>
                        <div class="mt-1">
                            <textarea id="live-class-description" name="description" rows="3" class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md"></textarea>
                        </div>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" id="cancel-live-class-btn" class="inline-flex justify-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            Cancel
                        </button>
                        <button type="submit" class="inline-flex justify-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            Save
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmation-modal" class="fixed z-50 inset-0 overflow-y-auto hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6">
                <div class="sm:flex sm:items-start">
                    <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10">
                        <svg class="h-6 w-6 text-red-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                        </svg>
                    </div>
                    <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                        <h3 class="text-lg leading-6 font-medium text-gray-900" id="confirmation-modal-title">Delete Item</h3>
                        <div class="mt-2">
                            <p class="text-sm text-gray-500" id="confirmation-modal-message">Are you sure you want to delete this item? This action cannot be undone.</p>
                        </div>
                    </div>
                </div>
                <div class="mt-5 sm:mt-6 sm:grid sm:grid-cols-2 sm:gap-3 sm:grid-flow-row-dense">
                    <button type="button" id="confirm-delete-btn" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:col-start-2 sm:text-sm">
                        Delete
                    </button>
                    <button type="button" id="cancel-delete-btn" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:col-start-1 sm:text-sm">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container" class="fixed bottom-4 right-4 space-y-2 z-50"></div>

    <script>
        // Global variables
        let currentUser = null;
        let currentUserRole = null;
        let currentBatchId = null;
        let currentSubjectId = null;
        let currentChapterId = null;
        let currentItemToDelete = null;
        let deleteCallback = null;

        // DOM Elements
        const app = document.getElementById('app');
        const landingPage = document.getElementById('landing-page');
        const userDashboard = document.getElementById('user-dashboard');
        const adminDashboard = document.getElementById('admin-dashboard');
        const profilePage = document.getElementById('profile-page');
        const settingsPage = document.getElementById('settings-page');
        const mainNav = document.getElementById('main-nav');
        const authModal = document.getElementById('auth-modal');
        const batchModal = document.getElementById('batch-modal');
        const subjectModal = document.getElementById('subject-modal');
        const chapterModal = document.getElementById('chapter-modal');
        const lectureModal = document.getElementById('lecture-modal');
        const dppModal = document.getElementById('dpp-modal');
        const liveClassModal = document.getElementById('live-class-modal');
        const confirmationModal = document.getElementById('confirmation-modal');
        const toastContainer = document.getElementById('toast-container');
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileSidebarToggle = document.getElementById('mobile-sidebar-toggle');

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD6zeZHhYGPDlyDIayILQRYoF3VKV6YLjM",
            authDomain: "telegramlogin.firebaseapp.com",
            databaseURL: "https://telegramlogin-default-rtdb.firebaseio.com",
            projectId: "telegramlogin",
            storageBucket: "telegramlogin.firebasestorage.app",
            messagingSenderId: "172368897023",
            appId: "1:172368897023:web:ed019216971c39de67fdca",
            measurementId: "G-J7LDTQT69W"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Check auth state
            auth.onAuthStateChanged(user => {
                if (user) {
                    currentUser = user;
                    checkUserRole(user.uid);
                } else {
                    showLandingPage();
                }
            });

            // Set up event listeners
            setupEventListeners();
        });

        // Check user role
        function checkUserRole(uid) {
            db.ref(`users/${uid}`).once('value')
                .then(snapshot => {
                    const userData = snapshot.val();
                    if (userData) {
                        currentUserRole = userData.role || 'student';
                        if (currentUserRole === 'admin') {
                            showAdminDashboard();
                        } else {
                            showUserDashboard();
                        }
                    } else {
                        // New user, set default role to student
                        db.ref(`users/${uid}`).set({
                            email: currentUser.email,
                            name: currentUser.displayName || '',
                            role: 'student',
                            createdAt: new Date().toISOString()
                        });
                        currentUserRole = 'student';
                        showUserDashboard();
                    }
                })
                .catch(error => {
                    console.error("Error checking user role:", error);
                    showToast('Error checking user role', 'error');
                });
        }

        // Show landing page
        function showLandingPage() {
            landingPage.classList.remove('hidden');
            userDashboard.classList.add('hidden');
            adminDashboard.classList.add('hidden');
            profilePage.classList.add('hidden');
            settingsPage.classList.add('hidden');
            mainNav.classList.add('hidden');
            document.querySelector('footer').classList.add('hidden');
        }

        // Show user dashboard
        function showUserDashboard() {
            landingPage.classList.add('hidden');
            userDashboard.classList.remove('hidden');
            adminDashboard.classList.add('hidden');
            profilePage.classList.add('hidden');
            settingsPage.classList.add('hidden');
            mainNav.classList.remove('hidden');
            document.querySelector('footer').classList.remove('hidden');

            // Load user data
            loadUserBatches();

            // Update navigation
            updateNavigation('user');
        }

        // Show admin dashboard
        function showAdminDashboard() {
            landingPage.classList.add('hidden');
            userDashboard.classList.add('hidden');
            adminDashboard.classList.remove('hidden');
            profilePage.classList.add('hidden');
            settingsPage.classList.add('hidden');
            mainNav.classList.add('hidden');
            document.querySelector('footer').classList.add('hidden');

            // Load admin data
            loadAdminBatches();

            // Update navigation
            updateNavigation('admin');
        }

        // Show profile page
        function showProfilePage() {
            landingPage.classList.add('hidden');
            userDashboard.classList.add('hidden');
            adminDashboard.classList.add('hidden');
            profilePage.classList.remove('hidden');
            settingsPage.classList.add('hidden');
            mainNav.classList.remove('hidden');
            document.querySelector('footer').classList.remove('hidden');

            // Load profile data
            loadProfileData();
        }

        // Show settings page
        function showSettingsPage() {
            landingPage.classList.add('hidden');
            userDashboard.classList.add('hidden');
            adminDashboard.classList.add('hidden');
            profilePage.classList.add('hidden');
            settingsPage.classList.remove('hidden');
            mainNav.classList.remove('hidden');
            document.querySelector('footer').classList.remove('hidden');
        }

        // Update navigation based on user role
        function updateNavigation(role) {
            const navLinks = document.getElementById('nav-links');
            navLinks.innerHTML = '';

            if (role === 'user') {
                const dashboardLink = document.createElement('a');
                dashboardLink.href = '#';
                dashboardLink.className = 'text-gray-500 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium';
                dashboardLink.textContent = 'Dashboard';
                dashboardLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    showUserDashboard();
                });

                const profileLink = document.createElement('a');
                profileLink.href = '#';
                profileLink.className = 'text-gray-500 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium';
                profileLink.textContent = 'Profile';
                profileLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    showProfilePage();
                });

                const settingsLink = document.createElement('a');
                settingsLink.href = '#';
                settingsLink.className = 'text-gray-500 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium';
                settingsLink.textContent = 'Settings';
                settingsLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    showSettingsPage();
                });

                navLinks.appendChild(dashboardLink);
                navLinks.appendChild(profileLink);
                navLinks.appendChild(settingsLink);
            }

            // Update user menu
            const userMenuButton = document.getElementById('user-menu-button');
            if (userMenuButton) {
                userMenuButton.addEventListener('click', () => {
                    const menu = document.createElement('div');
                    menu.className = 'origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg py-1 bg-white ring-1 ring-black ring-opacity-5 focus:outline-none';
                    menu.role = 'menu';
                    menu.ariaOrientation = 'vertical';
                    menu.ariaLabelledby = 'user-menu-button';
                    menu.tabIndex = '-1';

                    const profileItem = document.createElement('a');
                    profileItem.href = '#';
                    profileItem.className = 'block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100';
                    profileItem.role = 'menuitem';
                    profileItem.textContent = 'Your Profile';
                    profileItem.addEventListener('click', (e) => {
                        e.preventDefault();
                        showProfilePage();
                        menu.remove();
                    });

                    const settingsItem = document.createElement('a');
                    settingsItem.href = '#';
                    settingsItem.className = 'block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100';
                    settingsItem.role = 'menuitem';
                    settingsItem.textContent = 'Settings';
                    settingsItem.addEventListener('click', (e) => {
                        e.preventDefault();
                        showSettingsPage();
                        menu.remove();
                    });

                    const divider = document.createElement('div');
                    divider.className = 'border-t border-gray-200';

                    const signOutItem = document.createElement('a');
                    signOutItem.href = '#';
                    signOutItem.className = 'block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100';
                    signOutItem.role = 'menuitem';
                    signOutItem.textContent = 'Sign out';
                    signOutItem.addEventListener('click', (e) => {
                        e.preventDefault();
                        signOut();
                        menu.remove();
                    });

                    menu.appendChild(profileItem);
                    menu.appendChild(settingsItem);
                    menu.appendChild(divider);
                    menu.appendChild(signOutItem);

                    document.body.appendChild(menu);

                    // Position the menu
                    const rect = userMenuButton.getBoundingClientRect();
                    menu.style.position = 'absolute';
                    menu.style.top = `${rect.bottom + window.scrollY}px`;
                    menu.style.right = `${window.innerWidth - rect.right}px`;

                    // Close menu when clicking outside
                    setTimeout(() => {
                        document.addEventListener('click', function closeMenu(e) {
                            if (!menu.contains(e.target) && e.target !== userMenuButton) {
                                menu.remove();
                                document.removeEventListener('click', closeMenu);
                            }
                        });
                    }, 0);
                });
            }

            // Update admin user menu
            const adminUserMenuButton = document.getElementById('admin-user-menu-button');
            if (adminUserMenuButton) {
                adminUserMenuButton.addEventListener('click', () => {
                    const menu = document.createElement('div');
                    menu.className = 'origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg py-1 bg-white ring-1 ring-black ring-opacity-5 focus:outline-none';
                    menu.role = 'menu';
                    menu.ariaOrientation = 'vertical';
                    menu.ariaLabelledby = 'admin-user-menu-button';
                    menu.tabIndex = '-1';

                    const profileItem = document.createElement('a');
                    profileItem.href = '#';
                    profileItem.className = 'block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100';
                    profileItem.role = 'menuitem';
                    profileItem.textContent = 'Your Profile';
                    profileItem.addEventListener('click', (e) => {
                        e.preventDefault();
                        showProfilePage();
                        menu.remove();
                    });

                    const settingsItem = document.createElement('a');
                    settingsItem.href = '#';
                    settingsItem.className = 'block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100';
                    settingsItem.role = 'menuitem';
                    settingsItem.textContent = 'Settings';
                    settingsItem.addEventListener('click', (e) => {
                        e.preventDefault();
                        showSettingsPage();
                        menu.remove();
                    });

                    const divider = document.createElement('div');
                    divider.className = 'border-t border-gray-200';

                    const signOutItem = document.createElement('a');
                    signOutItem.href = '#';
                    signOutItem.className = 'block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100';
                    signOutItem.role = 'menuitem';
                    signOutItem.textContent = 'Sign out';
                    signOutItem.addEventListener('click', (e) => {
                        e.preventDefault();
                        signOut();
                        menu.remove();
                    });

                    menu.appendChild(profileItem);
                    menu.appendChild(settingsItem);
                    menu.appendChild(divider);
                    menu.appendChild(signOutItem);

                    document.body.appendChild(menu);

                    // Position the menu
                    const rect = adminUserMenuButton.getBoundingClientRect();
                    menu.style.position = 'absolute';
                    menu.style.top = `${rect.bottom + window.scrollY}px`;
                    menu.style.right = `${window.innerWidth - rect.right}px`;

                    // Close menu when clicking outside
                    setTimeout(() => {
                        document.addEventListener('click', function closeMenu(e) {
                            if (!menu.contains(e.target) && e.target !== adminUserMenuButton) {
                                menu.remove();
                                document.removeEventListener('click', closeMenu);
                            }
                        });
                    }, 0);
                });
            }
        }

        // Load user batches
        function loadUserBatches() {
            const batchesContainer = document.querySelector('#user-dashboard .grid');
            batchesContainer.innerHTML = '<div class="col-span-full text-center py-12"><div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-indigo-500"></div></div>';

            db.ref('batches').once('value')
                .then(snapshot => {
                    batchesContainer.innerHTML = '';
                    const batches = snapshot.val();

                    if (!batches) {
                        batchesContainer.innerHTML = '<div class="col-span-full text-center py-12"><p class="text-gray-500">No batches available</p></div>';
                        return;
                    }

                    for (const batchId in batches) {
                        const batch = batches[batchId];
                        const batchCard = document.createElement('div');
                        batchCard.className = 'bg-white rounded-lg shadow overflow-hidden custom-transition custom-hover';

                        batchCard.innerHTML = `
                            <div class="p-6">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <div class="p-3 rounded-full bg-indigo-50">
                                            <svg class="h-6 w-6 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                                            </svg>
                                        </div>
                                        <div class="ml-4">
                                            <h3 class="text-lg font-medium text-gray-900">${batch.name}</h3>
                                            <p class="text-sm text-gray-500">${batch.description || 'No description available'}</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <div class="flex items-center text-sm text-gray-500">
                                        <svg class="flex-shrink-0 mr-1.5 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                            <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
                                        </svg>
                                        <span>Starts ${new Date(batch.startDate).toLocaleDateString()}</span>
                                    </div>
                                    <div class="flex items-center text-sm text-gray-500 mt-2">
                                        <svg class="flex-shrink-0 mr-1.5 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                                        </svg>
                                        <span>${batch.duration} months duration</span>
                                    </div>
                                    <div class="flex items-center text-sm text-gray-500 mt-2">
                                        <svg class="flex-shrink-0 mr-1.5 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                            <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                                        </svg>
                                        <span>${batch.instructor}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-gray-50 px-6 py-4">
                                <button class="view-batch-btn w-full flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-indigo-700 bg-indigo-100 hover:bg-indigo-200" data-batch-id="${batchId}">
                                    View Batch Details
                                </button>
                            </div>
                        `;

                        batchesContainer.appendChild(batchCard);
                    }
                })
                .catch(error => {
                    console.error("Error loading batches:", error);
                    batchesContainer.innerHTML = '<div class="col-span-full text-center py-12"><p class="text-gray-500">Error loading batches</p></div>';
                    showToast('Error loading batches', 'error');
                });
        }

        // Load admin batches
        function loadAdminBatches() {
            const batchesList = document.getElementById('batches-list');
            batchesList.innerHTML = '<li class="py-4 px-4 text-center"><div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-indigo-500"></div></li>';

            db.ref('batches').on('value', snapshot => {
                batchesList.innerHTML = '';
                const batches = snapshot.val();

                if (!batches) {
                    batchesList.innerHTML = '<li class="py-4 px-4 text-center"><p class="text-gray-500">No batches available</p></li>';
                    return;
                }

                for (const batchId in batches) {
                    const batch = batches[batchId];
                    const batchItem = document.createElement('li');
                    batchItem.className = 'px-4 py-4 sm:px-6';

                    batchItem.innerHTML = `
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 h-10 w-10 rounded-full bg-indigo-100 flex items-center justify-center">
                                    <svg class="h-6 w-6 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                                    </svg>
                                </div>
                                <div class="ml-4">
                                    <h4 class="text-sm font-medium text-gray-900">${batch.name}</h4>
                                    <p class="text-sm text-gray-500">${batch.description || 'No description available'}</p>
                                </div>
                            </div>
                            <div class="ml-4 flex-shrink-0 flex space-x-2">
                                <button class="edit-batch-btn px-3 py-1 bg-blue-100 text-blue-700 text-xs font-medium rounded-md hover:bg-blue-200" data-batch-id="${batchId}">
                                    Edit
                                </button>
                                <button class="delete-batch-btn px-3 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-md hover:bg-red-200" data-batch-id="${batchId}">
                                    Delete
                                </button>
                            </div>
                        </div>
                    `;

                    batchesList.appendChild(batchItem);
                }

                // Add event listeners
                document.querySelectorAll('.edit-batch-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const batchId = e.target.getAttribute('data-batch-id');
                        editBatch(batchId);
                    });
                });

                document.querySelectorAll('.delete-batch-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const batchId = e.target.getAttribute('data-batch-id');
                        showDeleteConfirmation('batch', batchId, () => {
                            deleteBatch(batchId);
                        });
                    });
                });
            });
        }

        // Load admin subjects
        function loadAdminSubjects(batchId) {
            const subjectsList = document.getElementById('subjects-admin-list');
            subjectsList.innerHTML = '<li class="py-4 px-4 text-center"><div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-indigo-500"></div></li>';

            db.ref('subjects').orderByChild('batchId').equalTo(batchId).on('value', snapshot => {
                subjectsList.innerHTML = '';
                const subjects = snapshot.val();

                if (!subjects) {
                    subjectsList.innerHTML = '<li class="py-4 px-4 text-center"><p class="text-gray-500">No subjects available for this batch</p></li>';
                    return;
                }

                for (const subjectId in subjects) {
                    const subject = subjects[subjectId];
                    const subjectItem = document.createElement('li');
                    subjectItem.className = 'px-4 py-4 sm:px-6';

                    subjectItem.innerHTML = `
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center">
                                    <svg class="h-6 w-6 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332-.477 4.5-1.253m0-13C13.168 5.477 14.754 5 16.5 5S19.832 5.477 21 6.253v13C19.832 18.477 18.247 18 16.5 18s-3.332-.477-4.5-1.253" />
                                    </svg>
                                </div>
                                <div class="ml-4">
                                    <h4 class="text-sm font-medium text-gray-900">${subject.name}</h4>
                                    <p class="text-sm text-gray-500">${subject.code} • ${subject.credits} credits</p>
                                    <p class="text-sm text-gray-500 mt-1">${subject.description || 'No description available'}</p>
                                </div>
                            </div>
                            <div class="ml-4 flex-shrink-0 flex space-x-2">
                                <button class="edit-subject-btn px-3 py-1 bg-blue-100 text-blue-700 text-xs font-medium rounded-md hover:bg-blue-200" data-subject-id="${subjectId}">
                                    Edit
                                </button>
                                <button class="delete-subject-btn px-3 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-md hover:bg-red-200" data-subject-id="${subjectId}">
                                    Delete
                                </button>
                            </div>
                        </div>
                    `;

                    subjectsList.appendChild(subjectItem);
                }

                // Add event listeners
                document.querySelectorAll('.edit-subject-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const subjectId = e.target.getAttribute('data-subject-id');
                        editSubject(subjectId);
                    });
                });

                document.querySelectorAll('.delete-subject-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const subjectId = e.target.getAttribute('data-subject-id');
                        showDeleteConfirmation('subject', subjectId, () => {
                            deleteSubject(subjectId);
                        });
                    });
                });
            });
        }

        // Load admin chapters
        function loadAdminChapters(subjectId) {
            const chaptersList = document.getElementById('chapters-admin-list');
            chaptersList.innerHTML = '<li class="py-4 px-4 text-center"><div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-indigo-500"></div></li>';

            db.ref('chapters').orderByChild('subjectId').equalTo(subjectId).on('value', snapshot => {
                chaptersList.innerHTML = '';
                const chapters = snapshot.val();

                if (!chapters) {
                    chaptersList.innerHTML = '<li class="py-4 px-4 text-center"><p class="text-gray-500">No chapters available for this subject</p></li>';
                    return;
                }

                // Sort chapters by number
                const sortedChapters = [];
                for (const chapterId in chapters) {
                    sortedChapters.push({ id: chapterId, ...chapters[chapterId] });
                }
                sortedChapters.sort((a, b) => a.number - b.number);

                sortedChapters.forEach(chapter => {
                    const chapterItem = document.createElement('li');
                    chapterItem.className = 'px-4 py-4 sm:px-6';

                    chapterItem.innerHTML = `
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 h-10 w-10 rounded-full bg-green-100 flex items-center justify-center">
                                    <svg class="h-6 w-6 text-green-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
                                    </svg>
                                </div>
                                <div class="ml-4">
                                    <h4 class="text-sm font-medium text-gray-900">${chapter.title}</h4>
                                    <p class="text-sm text-gray-500">Chapter ${chapter.number} • ${chapter.duration} hours</p>
                                    <p class="text-sm text-gray-500 mt-1">${chapter.description || 'No description available'}</p>
                                </div>
                            </div>
                            <div class="ml-4 flex-shrink-0 flex space-x-2">
                                <button class="edit-chapter-btn px-3 py-1 bg-blue-100 text-blue-700 text-xs font-medium rounded-md hover:bg-blue-200" data-chapter-id="${chapter.id}">
                                    Edit
                                </button>
                                <button class="delete-chapter-btn px-3 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-md hover:bg-red-200" data-chapter-id="${chapter.id}">
                                    Delete
                                </button>
                            </div>
                        </div>
                    `;

                    chaptersList.appendChild(chapterItem);
                });

                // Add event listeners
                document.querySelectorAll('.edit-chapter-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const chapterId = e.target.getAttribute('data-chapter-id');
                        editChapter(chapterId);
                    });
                });

                document.querySelectorAll('.delete-chapter-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const chapterId = e.target.getAttribute('data-chapter-id');
                        showDeleteConfirmation('chapter', chapterId, () => {
                            deleteChapter(chapterId);
                        });
                    });
                });
            });
        }

        // Load admin lectures
        function loadAdminLectures(chapterId) {
            const lecturesList = document.getElementById('lectures-admin-list');
            lecturesList.innerHTML = '<li class="py-4 px-4 text-center"><div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-indigo-500"></div></li>';

            db.ref('lectures').orderByChild('chapterId').equalTo(chapterId).on('value', snapshot => {
                lecturesList.innerHTML = '';
                const lectures = snapshot.val();

                if (!lectures) {
                    lecturesList.innerHTML = '<li class="py-4 px-4 text-center"><p class="text-gray-500">No lectures available for this chapter</p></li>';
                    return;
                }

                // Sort lectures by number
                const sortedLectures = [];
                for (const lectureId in lectures) {
                    sortedLectures.push({ id: lectureId, ...lectures[lectureId] });
                }
                sortedLectures.sort((a, b) => a.number - b.number);

                sortedLectures.forEach(lecture => {
                    const lectureItem = document.createElement('li');
                    lectureItem.className = 'px-4 py-4 sm:px-6';

                    lectureItem.innerHTML = `
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 h-10 w-10 rounded-full bg-green-100 flex items-center justify-center">
                                    <svg class="h-6 w-6 text-green-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                </div>
                                <div class="ml-4">
                                    <h4 class="text-sm font-medium text-gray-900">${lecture.title}</h4>
                                    <p class="text-sm text-gray-500">Lecture ${lecture.number} • ${new Date(lecture.date).toLocaleDateString()}</p>
                                    <p class="text-sm text-gray-500 mt-1">${lecture.description || 'No description available'}</p>
                                </div>
                            </div>
                            <div class="ml-4 flex-shrink-0 flex space-x-2">
                                <button class="edit-lecture-btn px-3 py-1 bg-blue-100 text-blue-700 text-xs font-medium rounded-md hover:bg-blue-200" data-lecture-id="${lecture.id}">
                                    Edit
                                </button>
                                <button class="delete-lecture-btn px-3 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-md hover:bg-red-200" data-lecture-id="${lecture.id}">
                                    Delete
                                </button>
                            </div>
                        </div>
                    `;

                    lecturesList.appendChild(lectureItem);
                });

                // Add event listeners
                document.querySelectorAll('.edit-lecture-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const lectureId = e.target.getAttribute('data-lecture-id');
                        editLecture(lectureId);
                    });
                });

                document.querySelectorAll('.delete-lecture-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const lectureId = e.target.getAttribute('data-lecture-id');
                        showDeleteConfirmation('lecture', lectureId, () => {
                            deleteLecture(lectureId);
                        });
                    });
                });
            });
        }

        // Load admin DPPs
        function loadAdminDpps(chapterId) {
            const dppsList = document.getElementById('dpps-admin-list');
            dppsList.innerHTML = '<li class="py-4 px-4 text-center"><div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-indigo-500"></div></li>';

            db.ref('dpps').orderByChild('chapterId').equalTo(chapterId).on('value', snapshot => {
                dppsList.innerHTML = '';
                const dpps = snapshot.val();

                if (!dpps) {
                    dppsList.innerHTML = '<li class="py-4 px-4 text-center"><p class="text-gray-500">No DPPs available for this chapter</p></li>';
                    return;
                }

                // Sort DPPs by number
                const sortedDpps = [];
                for (const dppId in dpps) {
                    sortedDpps.push({ id: dppId, ...dpps[dppId] });
                }
                sortedDpps.sort((a, b) => a.number - b.number);

                sortedDpps.forEach(dpp => {
                    const dppItem = document.createElement('li');
                    dppItem.className = 'px-4 py-4 sm:px-6';

                    dppItem.innerHTML = `
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 h-10 w-10 rounded-full bg-purple-100 flex items-center justify-center">
                                    <svg class="h-6 w-6 text-purple-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
                                    </svg>
                                </div>
                                <div class="ml-4">
                                    <h4 class="text-sm font-medium text-gray-900">${dpp.title}</h4>
                                    <p class="text-sm text-gray-500">DPP ${dpp.number} • Due ${new Date(dpp.dueDate).toLocaleDateString()}</p>
                                    <p class="text-sm text-gray-500 mt-1">${dpp.description || 'No description available'}</p>
                                </div>
                            </div>
                            <div class="ml-4 flex-shrink-0 flex space-x-2">
                                <button class="edit-dpp-btn px-3 py-1 bg-blue-100 text-blue-700 text-xs font-medium rounded-md hover:bg-blue-200" data-dpp-id="${dpp.id}">
                                    Edit
                                </button>
                                <button class="delete-dpp-btn px-3 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-md hover:bg-red-200" data-dpp-id="${dpp.id}">
                                    Delete
                                </button>
                            </div>
                        </div>
                    `;

                    dppsList.appendChild(dppItem);
                });

                // Add event listeners
                document.querySelectorAll('.edit-dpp-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const dppId = e.target.getAttribute('data-dpp-id');
                        editDpp(dppId);
                    });
                });

                document.querySelectorAll('.delete-dpp-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const dppId = e.target.getAttribute('data-dpp-id');
                        showDeleteConfirmation('dpp', dppId, () => {
                            deleteDpp(dppId);
                        });
                    });
                });
            });
        }

        // Load admin live classes
        function loadAdminLiveClasses(batchId) {
            const liveClassesList = document.getElementById('live-classes-admin-list');
            liveClassesList.innerHTML = '<li class="py-4 px-4 text-center"><div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-indigo-500"></div></li>';

            db.ref('liveClasses').orderByChild('batchId').equalTo(batchId).on('value', snapshot => {
                liveClassesList.innerHTML = '';
                const liveClasses = snapshot.val();

                if (!liveClasses) {
                    liveClassesList.innerHTML = '<li class="py-4 px-4 text-center"><p class="text-gray-500">No live classes scheduled for this batch</p></li>';
                    return;
                }

                // Sort live classes by date and time
                const sortedClasses = [];
                for (const classId in liveClasses) {
                    sortedClasses.push({ id: classId, ...liveClasses[classId] });
                }
                sortedClasses.sort((a, b) => {
                    const dateA = new Date(`${a.date}T${a.time}`);
                    const dateB = new Date(`${b.date}T${b.time}`);
                    return dateA - dateB;
                });

                const now = new Date();

                sortedClasses.forEach(cls => {
                    const classItem = document.createElement('li');
                    classItem.className = 'px-4 py-4 sm:px-6';

                    const classDate = new Date(`${cls.date}T${cls.time}`);
                    const isPast = classDate < now;

                    classItem.innerHTML = `
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 h-10 w-10 rounded-full ${isPast ? 'bg-gray-100' : 'bg-indigo-100'} flex items-center justify-center">
                                    <svg class="h-6 w-6 ${isPast ? 'text-gray-400' : 'text-indigo-600'}" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
                                    </svg>
                                </div>
                                <div class="ml-4">
                                    <h4 class="text-sm font-medium text-gray-900">${cls.title}</h4>
                                    <p class="text-sm text-gray-500">
                                        ${classDate.toLocaleDateString()} • ${classDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})} • ${cls.duration} mins
                                    </p>
                                    <p class="text-sm text-gray-500 mt-1">${cls.description || 'No description available'}</p>
                                </div>
                            </div>
                            <div class="ml-4 flex-shrink-0 flex space-x-2">
                                <button class="edit-live-class-btn px-3 py-1 bg-blue-100 text-blue-700 text-xs font-medium rounded-md hover:bg-blue-200" data-live-class-id="${cls.id}">
                                    Edit
                                </button>
                                <button class="delete-live-class-btn px-3 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-md hover:bg-red-200" data-live-class-id="${cls.id}">
                                    Delete
                                </button>
                            </div>
                        </div>
                    `;

                    liveClassesList.appendChild(classItem);
                });

                // Add event listeners
                document.querySelectorAll('.edit-live-class-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const classId = e.target.getAttribute('data-live-class-id');
                        editLiveClass(classId);
                    });
                });

                document.querySelectorAll('.delete-live-class-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const classId = e.target.getAttribute('data-live-class-id');
                        showDeleteConfirmation('liveClass', classId, () => {
                            deleteLiveClass(classId);
                        });
                    });
                });
            });
        }

        // Load profile data
        function loadProfileData() {
            const profileName = document.getElementById('profile-name');
            const profileEmail = document.getElementById('profile-email');
            const profilePhone = document.getElementById('profile-phone');
            const profileRole = document.getElementById('profile-role');
            const profileBatches = document.getElementById('profile-batches');
            const updateName = document.getElementById('update-name');
            const updatePhone = document.getElementById('update-phone');

            // Show loading state
            profileName.textContent = 'Loading...';
            profileEmail.textContent = '';
            profilePhone.textContent = '';
            profileRole.textContent = '';
            profileBatches.textContent = '';

            db.ref(`users/${currentUser.uid}`).once('value')
                .then(snapshot => {
                    const userData = snapshot.val();
                    if (!userData) return;

                    profileName.textContent = userData.name || 'Not specified';
                    profileEmail.textContent = currentUser.email;
                    profilePhone.textContent = userData.phone || 'Not specified';
                    profileRole.textContent = userData.role || 'student';

                    updateName.value = userData.name || '';
                    updatePhone.value = userData.phone || '';

                    // Load enrolled batches
                    if (userData.enrolledBatches) {
                        const batchPromises = Object.keys(userData.enrolledBatches).map(batchId =>
                            db.ref(`batches/${batchId}`).once('value')
                        );

                        return Promise.all(batchPromises);
                    }
                    return null;
                })
                .then(batches => {
                    if (batches) {
                        const batchNames = batches
                            .map(snapshot => snapshot.val())
                            .filter(batch => batch)
                            .map(batch => batch.name)
                            .join(', ');

                        profileBatches.textContent = batchNames || 'None';
                    } else {
                        profileBatches.textContent = 'None';
                    }
                })
                .catch(error => {
                    console.error("Error loading profile data:", error);
                    showToast('Error loading profile data', 'error');
                });
        }

        // Update profile
        function updateProfile() {
            const name = document.getElementById('update-name').value;
            const phone = document.getElementById('update-phone').value;
            const password = document.getElementById('update-password').value;

            const updates = {
                name: name,
                phone: phone
            };

            if (password) {
                // Update password
                currentUser.updatePassword(password)
                    .then(() => {
                        return db.ref(`users/${currentUser.uid}`).update(updates);
                    })
                    .then(() => {
                        showToast('Profile updated successfully', 'success');
                        loadProfileData();
                    })
                    .catch(error => {
                        console.error("Error updating profile:", error);
                        showToast(error.message, 'error');
                    });
            } else {
                // Update profile without password
                db.ref(`users/${currentUser.uid}`).update(updates)
                    .then(() => {
                        showToast('Profile updated successfully', 'success');
                        loadProfileData();
                    })
                    .catch(error => {
                        console.error("Error updating profile:", error);
                        showToast(error.message, 'error');
                    });
            }
        }

        // Delete account
        function deleteAccount() {
            currentUser.delete()
                .then(() => {
                    return db.ref(`users/${currentUser.uid}`).remove();
                })
                .then(() => {
                    showToast('Account deleted successfully', 'success');
                    signOut();
                })
                .catch(error => {
                    console.error("Error deleting account:", error);
                    showToast(error.message, 'error');
                });
        }

        // Show auth modal
        function showAuthModal(mode = 'login') {
            authModal.classList.remove('hidden');

            const modalTitle = document.querySelector('#auth-modal h3');
            const submitBtn = document.querySelector('#auth-form button[type="submit"]');

            if (mode === 'login') {
                modalTitle.textContent = 'Welcome Back';
                submitBtn.textContent = 'Sign in';
            } else {
                modalTitle.textContent = 'Create Account';
                submitBtn.textContent = 'Sign up';
            }

            // Set up Google sign-in
            document.getElementById('google-signin-btn').addEventListener('click', () => {
                const provider = new firebase.auth.GoogleAuthProvider();
                auth.signInWithPopup(provider)
                    .catch(error => {
                        console.error("Google sign-in error:", error);
                        showToast(error.message, 'error');
                    });
            });

            // Set up form submission
            document.getElementById('auth-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;

                if (mode === 'login') {
                    auth.signInWithEmailAndPassword(email, password)
                        .catch(error => {
                            console.error("Login error:", error);
                            showToast(error.message, 'error');
                        });
                } else {
                    auth.createUserWithEmailAndPassword(email, password)
                        .catch(error => {
                            console.error("Signup error:", error);
                            showToast(error.message, 'error');
                        });
                }
            });
        }

        // Sign out
        function signOut() {
            auth.signOut()
                .then(() => {
                    currentUser = null;
                    currentUserRole = null;
                    showLandingPage();
                })
                .catch(error => {
                    console.error("Sign out error:", error);
                    showToast(error.message, 'error');
                });
        }

        // Show toast notification
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `px-4 py-2 rounded-md shadow-lg text-white ${type === 'success' ? 'bg-green-600' : type === 'error' ? 'bg-red-600' : 'bg-blue-600'}`;

            const toastIcon = document.createElement('svg');
            toastIcon.className = 'inline h-5 w-5 mr-2';
            toastIcon.setAttribute('fill', 'none');
            toastIcon.setAttribute('viewBox', '0 0 24 24');
            toastIcon.setAttribute('stroke', 'currentColor');

            const path = document.createElement('path');
            path.setAttribute('stroke-linecap', 'round');
            path.setAttribute('stroke-linejoin', 'round');
            path.setAttribute('stroke-width', '2');

            if (type === 'success') {
                path.setAttribute('d', 'M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z');
            } else if (type === 'error') {
                path.setAttribute('d', 'M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z');
            } else {
                path.setAttribute('d', 'M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z');
            }

            toastIcon.appendChild(path);
            toast.appendChild(toastIcon);
            toast.appendChild(document.createTextNode(message));

            toastContainer.appendChild(toast);

            // Remove toast after 5 seconds
            setTimeout(() => {
                toast.classList.add('opacity-0', 'transition-opacity', 'duration-500');
                setTimeout(() => {
                    toast.remove();
                }, 500);
            }, 5000);
        }

        // Show delete confirmation
        function showDeleteConfirmation(type, id, callback) {
            currentItemToDelete = { type, id };
            deleteCallback = callback;

            const messageElement = document.getElementById('confirmation-modal-message');
            let message = '';

            switch (type) {
                case 'batch':
                    message = 'Are you sure you want to delete this batch? All related subjects, chapters, and resources will also be deleted.';
                    break;
                case 'subject':
                    message = 'Are you sure you want to delete this subject? All related chapters and resources will also be deleted.';
                    break;
                case 'chapter':
                    message = 'Are you sure you want to delete this chapter? All related lectures and DPPs will also be deleted.';
                    break;
                case 'lecture':
                    message = 'Are you sure you want to delete this lecture?';
                    break;
                case 'dpp':
                    message = 'Are you sure you want to delete this DPP?';
                    break;
                case 'liveClass':
                    message = 'Are you sure you want to delete this live class?';
                    break;
                case 'account':
                    message = 'Are you sure you want to delete your account? This action cannot be undone and all your data will be permanently lost.';
                    break;
                default:
                    message = 'Are you sure you want to delete this item? This action cannot be undone.';
            }

            messageElement.textContent = message;
            confirmationModal.classList.remove('hidden');
        }

        // Add batch
        function addBatch() {
            document.getElementById('batch-modal-title').textContent = 'Add New Batch';
            document.getElementById('batch-form').reset();
            document.getElementById('batch-id').value = '';
            batchModal.classList.remove('hidden');
        }

        // Edit batch
        function editBatch(batchId) {
            document.getElementById('batch-modal-title').textContent = 'Edit Batch';
            batchModal.classList.remove('hidden');

            db.ref(`batches/${batchId}`).once('value')
                .then(snapshot => {
                    const batch = snapshot.val();
                    if (batch) {
                        document.getElementById('batch-id').value = batchId;
                        document.getElementById('batch-name').value = batch.name;
                        document.getElementById('batch-description').value = batch.description || '';
                        document.getElementById('batch-start-date').value = batch.startDate;
                        document.getElementById('batch-duration').value = batch.duration;
                        document.getElementById('batch-instructor').value = batch.instructor;
                        document.getElementById('batch-capacity').value = batch.capacity;
                    }
                })
                .catch(error => {
                    console.error("Error loading batch data:", error);
                    showToast('Error loading batch data', 'error');
                });
        }

        // Delete batch
        function deleteBatch(batchId) {
            // First delete all related subjects
            db.ref('subjects').orderByChild('batchId').equalTo(batchId).once('value')
                .then(snapshot => {
                    const subjects = snapshot.val();
                    if (subjects) {
                        const subjectPromises = [];
                        for (const subjectId in subjects) {
                            subjectPromises.push(deleteSubject(subjectId));
                        }
                        return Promise.all(subjectPromises);
                    }
                    return null;
                })
                .then(() => {
                    // Then delete the batch
                    return db.ref(`batches/${batchId}`).remove();
                })
                .then(() => {
                    showToast('Batch deleted successfully', 'success');
                    confirmationModal.classList.add('hidden');
                })
                .catch(error => {
                    console.error("Error deleting batch:", error);
                    showToast('Error deleting batch', 'error');
                    confirmationModal.classList.add('hidden');
                });
        }

        // Add subject
        function addSubject() {
            const batchSelect = document.getElementById('subject-batch-select');
            const selectedBatchId = batchSelect.value;

            if (!selectedBatchId) {
                showToast('Please select a batch first', 'error');
                return;
            }

            document.getElementById('subject-modal-title').textContent = 'Add New Subject';
            document.getElementById('subject-form').reset();
            document.getElementById('subject-id').value = '';
            document.getElementById('subject-batch-id').value = selectedBatchId;
            subjectModal.classList.remove('hidden');
        }

        // Edit subject
        function editSubject(subjectId) {
            document.getElementById('subject-modal-title').textContent = 'Edit Subject';
            subjectModal.classList.remove('hidden');

            db.ref(`subjects/${subjectId}`).once('value')
                .then(snapshot => {
                    const subject = snapshot.val();
                    if (subject) {
                        document.getElementById('subject-id').value = subjectId;
                        document.getElementById('subject-batch-id').value = subject.batchId;
                        document.getElementById('subject-name').value = subject.name;
                        document.getElementById('subject-code').value = subject.code;
                        document.getElementById('subject-credits').value = subject.credits;
                        document.getElementById('subject-description').value = subject.description || '';
                    }
                })
                .catch(error => {
                    console.error("Error loading subject data:", error);
                    showToast('Error loading subject data', 'error');
                });
        }

        // Delete subject
        function deleteSubject(subjectId) {
            // First delete all related chapters
            return db.ref('chapters').orderByChild('subjectId').equalTo(subjectId).once('value')
                .then(snapshot => {
                    const chapters = snapshot.val();
                    if (chapters) {
                        const chapterPromises = [];
                        for (const chapterId in chapters) {
                            chapterPromises.push(deleteChapter(chapterId));
                        }
                        return Promise.all(chapterPromises);
                    }
                    return null;
                })
                .then(() => {
                    // Then delete the subject
                    return db.ref(`subjects/${subjectId}`).remove();
                })
                .catch(error => {
                    console.error("Error deleting subject:", error);
                    throw error;
                });
        }

        // Add chapter
        function addChapter() {
            const subjectSelect = document.getElementById('chapter-subject-select');
            const selectedSubjectId = subjectSelect.value;

            if (!selectedSubjectId) {
                showToast('Please select a subject first', 'error');
                return;
            }

            document.getElementById('chapter-modal-title').textContent = 'Add New Chapter';
            document.getElementById('chapter-form').reset();
            document.getElementById('chapter-id').value = '';
            document.getElementById('chapter-subject-id').value = selectedSubjectId;
            chapterModal.classList.remove('hidden');
        }

        // Edit chapter
        function editChapter(chapterId) {
            document.getElementById('chapter-modal-title').textContent = 'Edit Chapter';
            chapterModal.classList.remove('hidden');

            db.ref(`chapters/${chapterId}`).once('value')
                .then(snapshot => {
                    const chapter = snapshot.val();
                    if (chapter) {
                        document.getElementById('chapter-id').value = chapterId;
                        document.getElementById('chapter-subject-id').value = chapter.subjectId;
                        document.getElementById('chapter-title').value = chapter.title;
                        document.getElementById('chapter-number').value = chapter.number;
                        document.getElementById('chapter-duration').value = chapter.duration;
                        document.getElementById('chapter-description').value = chapter.description || '';
                    }
                })
                .catch(error => {
                    console.error("Error loading chapter data:", error);
                    showToast('Error loading chapter data', 'error');
                });
        }

        // Delete chapter
        function deleteChapter(chapterId) {
            // First delete all related lectures
            return db.ref('lectures').orderByChild('chapterId').equalTo(chapterId).once('value')
                .then(snapshot => {
                    const lectures = snapshot.val();
                    if (lectures) {
                        const lecturePromises = [];
                        for (const lectureId in lectures) {
                            lecturePromises.push(db.ref(`lectures/${lectureId}`).remove());
                        }
                        return Promise.all(lecturePromises);
                    }
                    return null;
                })
                .then(() => {
                    // Then delete all related DPPs
                    return db.ref('dpps').orderByChild('chapterId').equalTo(chapterId).once('value');
                })
                .then(snapshot => {
                    const dpps = snapshot.val();
                    if (dpps) {
                        const dppPromises = [];
                        for (const dppId in dpps) {
                            dppPromises.push(db.ref(`dpps/${dppId}`).remove());
                        }
                        return Promise.all(dppPromises);
                    }
                    return null;
                })
                .then(() => {
                    // Then delete the chapter
                    return db.ref(`chapters/${chapterId}`).remove();
                })
                .catch(error => {
                    console.error("Error deleting chapter:", error);
                    throw error;
                });
        }

        // Add lecture
        function addLecture() {
            const chapterSelect = document.getElementById('resource-chapter-select');
            const selectedChapterId = chapterSelect.value;

            if (!selectedChapterId) {
                showToast('Please select a chapter first', 'error');
                return;
            }

            document.getElementById('lecture-modal-title').textContent = 'Add New Lecture';
            document.getElementById('lecture-form').reset();
            document.getElementById('lecture-id').value = '';
            document.getElementById('lecture-chapter-id').value = selectedChapterId;
            document.getElementById('lecture-date').valueAsDate = new Date();
            lectureModal.classList.remove('hidden');
        }

        // Edit lecture
        function editLecture(lectureId) {
            document.getElementById('lecture-modal-title').textContent = 'Edit Lecture';
            lectureModal.classList.remove('hidden');

            db.ref(`lectures/${lectureId}`).once('value')
                .then(snapshot => {
                    const lecture = snapshot.val();
                    if (lecture) {
                        document.getElementById('lecture-id').value = lectureId;
                        document.getElementById('lecture-chapter-id').value = lecture.chapterId;
                        document.getElementById('lecture-title').value = lecture.title;
                        document.getElementById('lecture-number').value = lecture.number;
                        document.getElementById('lecture-date').value = lecture.date;
                        document.getElementById('lecture-description').value = lecture.description || '';
                        document.getElementById('lecture-content').value = lecture.content || '';
                    }
                })
                .catch(error => {
                    console.error("Error loading lecture data:", error);
                    showToast('Error loading lecture data', 'error');
                });
        }

        // Delete lecture
        function deleteLecture(lectureId) {
            return db.ref(`lectures/${lectureId}`).remove();
        }

        // Add DPP
        function addDpp() {
            const chapterSelect = document.getElementById('resource-chapter-select');
            const selectedChapterId = chapterSelect.value;

            if (!selectedChapterId) {
                showToast('Please select a chapter first', 'error');
                return;
            }

            document.getElementById('dpp-modal-title').textContent = 'Add New DPP';
            document.getElementById('dpp-form').reset();
            document.getElementById('dpp-id').value = '';
            document.getElementById('dpp-chapter-id').value = selectedChapterId;
            document.getElementById('dpp-date').valueAsDate = new Date();
            dppModal.classList.remove('hidden');
        }

        // Edit DPP
        function editDpp(dppId) {
            document.getElementById('dpp-modal-title').textContent = 'Edit DPP';
            dppModal.classList.remove('hidden');

            db.ref(`dpps/${dppId}`).once('value')
                .then(snapshot => {
                    const dpp = snapshot.val();
                    if (dpp) {
                        document.getElementById('dpp-id').value = dppId;
                        document.getElementById('dpp-chapter-id').value = dpp.chapterId;
                        document.getElementById('dpp-title').value = dpp.title;
                        document.getElementById('dpp-number').value = dpp.number;
                        document.getElementById('dpp-date').value = dpp.dueDate;
                        document.getElementById('dpp-description').value = dpp.description || '';
                        document.getElementById('dpp-content').value = dpp.content || '';
                        document.getElementById('dpp-solution').value = dpp.solution || '';
                    }
                })
                .catch(error => {
                    console.error("Error loading DPP data:", error);
                    showToast('Error loading DPP data', 'error');
                });
        }

        // Delete DPP
        function deleteDpp(dppId) {
            return db.ref(`dpps/${dppId}`).remove();
        }

        // Add live class
        function addLiveClass() {
            const batchSelect = document.getElementById('live-class-batch-select');
            const selectedBatchId = batchSelect.value;

            if (!selectedBatchId) {
                showToast('Please select a batch first', 'error');
                return;
            }

            document.getElementById('live-class-modal-title').textContent = 'Schedule Live Class';
            document.getElementById('live-class-form').reset();
            document.getElementById('live-class-id').value = '';
            document.getElementById('live-class-batch-id').value = selectedBatchId;
            document.getElementById('live-class-date').valueAsDate = new Date();
            document.getElementById('live-class-time').value = '09:00';
            document.getElementById('live-class-duration').value = '60';
            liveClassModal.classList.remove('hidden');
        }

        // Edit live class
        function editLiveClass(classId) {
            document.getElementById('live-class-modal-title').textContent = 'Edit Live Class';
            liveClassModal.classList.remove('hidden');

            db.ref(`liveClasses/${classId}`).once('value')
                .then(snapshot => {
                    const cls = snapshot.val();
                    if (cls) {
                        document.getElementById('live-class-id').value = classId;
                        document.getElementById('live-class-batch-id').value = cls.batchId;
                        document.getElementById('live-class-title').value = cls.title;
                        document.getElementById('live-class-date').value = cls.date;
                        document.getElementById('live-class-time').value = cls.time;
                        document.getElementById('live-class-duration').value = cls.duration;
                        document.getElementById('live-class-link').value = cls.link;
                        document.getElementById('live-class-description').value = cls.description || '';
                    }
                })
                .catch(error => {
                    console.error("Error loading live class data:", error);
                    showToast('Error loading live class data', 'error');
                });
        }

        // Delete live class
        function deleteLiveClass(classId) {
            return db.ref(`liveClasses/${classId}`).remove();
        }

        // Set up event listeners
        function setupEventListeners() {
            // Auth modal close
            document.addEventListener('click', (e) => {
                if (e.target === authModal) {
                    authModal.classList.add('hidden');
                }
            });

            // Close modals when clicking outside
            document.addEventListener('click', (e) => {
                if (e.target === batchModal) {
                    batchModal.classList.add('hidden');
                }
                if (e.target === subjectModal) {
                    subjectModal.classList.add('hidden');
                }
                if (e.target === chapterModal) {
                    chapterModal.classList.add('hidden');
                }
                if (e.target === lectureModal) {
                    lectureModal.classList.add('hidden');
                }
                if (e.target === dppModal) {
                    dppModal.classList.add('hidden');
                }
                if (e.target === liveClassModal) {
                    liveClassModal.classList.add('hidden');
                }
                if (e.target === confirmationModal) {
                    confirmationModal.classList.add('hidden');
                }
            });

            // Batch modal close
            document.getElementById('cancel-batch-btn').addEventListener('click', () => {
                batchModal.classList.add('hidden');
            });

            // Subject modal close
            document.getElementById('cancel-subject-btn').addEventListener('click', () => {
                subjectModal.classList.add('hidden');
            });

            // Chapter modal close
            document.getElementById('cancel-chapter-btn').addEventListener('click', () => {
                chapterModal.classList.add('hidden');
            });

            // Lecture modal close
            document.getElementById('cancel-lecture-btn').addEventListener('click', () => {
                lectureModal.classList.add('hidden');
            });

            // DPP modal close
            document.getElementById('cancel-dpp-btn').addEventListener('click', () => {
                dppModal.classList.add('hidden');
            });

            // Live class modal close
            document.getElementById('cancel-live-class-btn').addEventListener('click', () => {
                liveClassModal.classList.add('hidden');
            });

            // Confirmation modal close
            document.getElementById('cancel-delete-btn').addEventListener('click', () => {
                confirmationModal.classList.add('hidden');
            });

            // Confirm delete
            document.getElementById('confirm-delete-btn').addEventListener('click', () => {
                if (currentItemToDelete && deleteCallback) {
                    const { type, id } = currentItemToDelete;

                    if (type === 'account') {
                        deleteAccount();
                    } else if (type === 'batch') {
                        deleteBatch(id);
                    } else if (type === 'subject') {
                        deleteSubject(id)
                            .then(() => {
                                showToast('Subject deleted successfully', 'success');
                                confirmationModal.classList.add('hidden');
                            })
                            .catch(error => {
                                console.error("Error deleting subject:", error);
                                showToast('Error deleting subject', 'error');
                                confirmationModal.classList.add('hidden');
                            });
                    } else if (type === 'chapter') {
                        deleteChapter(id)
                            .then(() => {
                                showToast('Chapter deleted successfully', 'success');
                                confirmationModal.classList.add('hidden');
                            })
                            .catch(error => {
                                console.error("Error deleting chapter:", error);
                                showToast('Error deleting chapter', 'error');
                                confirmationModal.classList.add('hidden');
                            });
                    } else if (type === 'lecture') {
                        deleteLecture(id)
                            .then(() => {
                                showToast('Lecture deleted successfully', 'success');
                                confirmationModal.classList.add('hidden');
                            })
                            .catch(error => {
                                console.error("Error deleting lecture:", error);
                                showToast('Error deleting lecture', 'error');
                                confirmationModal.classList.add('hidden');
                            });
                    } else if (type === 'dpp') {
                        deleteDpp(id)
                            .then(() => {
                                showToast('DPP deleted successfully', 'success');
                                confirmationModal.classList.add('hidden');
                            })
                            .catch(error => {
                                console.error("Error deleting DPP:", error);
                                showToast('Error deleting DPP', 'error');
                                confirmationModal.classList.add('hidden');
                            });
                    } else if (type === 'liveClass') {
                        deleteLiveClass(id)
                            .then(() => {
                                showToast('Live class deleted successfully', 'success');
                                confirmationModal.classList.add('hidden');
                            })
                            .catch(error => {
                                console.error("Error deleting live class:", error);
                                showToast('Error deleting live class', 'error');
                                confirmationModal.classList.add('hidden');
                            });
                    }
                }
            });

            // Batch form submission
            document.getElementById('batch-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const batchId = document.getElementById('batch-id').value;
                const name = document.getElementById('batch-name').value;
                const description = document.getElementById('batch-description').value;
                const startDate = document.getElementById('batch-start-date').value;
                const duration = document.getElementById('batch-duration').value;
                const instructor = document.getElementById('batch-instructor').value;
                const capacity = document.getElementById('batch-capacity').value;

                const batchData = {
                    name,
                    description,
                    startDate,
                    duration: parseInt(duration),
                    instructor,
                    capacity: parseInt(capacity),
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };

                if (batchId) {
                    // Update existing batch
                    db.ref(`batches/${batchId}`).update(batchData)
                        .then(() => {
                            showToast('Batch updated successfully', 'success');
                            batchModal.classList.add('hidden');
                        })
                        .catch(error => {
                            console.error("Error updating batch:", error);
                            showToast('Error updating batch', 'error');
                        });
                } else {
                    // Add new batch
                    db.ref('batches').push(batchData)
                        .then(() => {
                            showToast('Batch added successfully', 'success');
                            batchModal.classList.add('hidden');
                        })
                        .catch(error => {
                            console.error("Error adding batch:", error);
                            showToast('Error adding batch', 'error');
                        });
                }
            });

            // Subject form submission
            document.getElementById('subject-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const subjectId = document.getElementById('subject-id').value;
                const batchId = document.getElementById('subject-batch-id').value;
                const name = document.getElementById('subject-name').value;
                const code = document.getElementById('subject-code').value;
                const credits = document.getElementById('subject-credits').value;
                const description = document.getElementById('subject-description').value;

                const subjectData = {
                    batchId,
                    name,
                    code,
                    credits: parseInt(credits),
                    description,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };

                if (subjectId) {
                    // Update existing subject
                    db.ref(`subjects/${subjectId}`).update(subjectData)
                        .then(() => {
                            showToast('Subject updated successfully', 'success');
                            subjectModal.classList.add('hidden');
                        })
                        .catch(error => {
                            console.error("Error updating subject:", error);
                            showToast('Error updating subject', 'error');
                        });
                } else {
                    // Add new subject
                    db.ref('subjects').push(subjectData)
                        .then(() => {
                            showToast('Subject added successfully', 'success');
                            subjectModal.classList.add('hidden');
                        })
                        .catch(error => {
                            console.error("Error adding subject:", error);
                            showToast('Error adding subject', 'error');
                        });
                }
            });

            // Chapter form submission
            document.getElementById('chapter-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const chapterId = document.getElementById('chapter-id').value;
                const subjectId = document.getElementById('chapter-subject-id').value;
                const title = document.getElementById('chapter-title').value;
                const number = document.getElementById('chapter-number').value;
                const duration = document.getElementById('chapter-duration').value;
                const description = document.getElementById('chapter-description').value;

                const chapterData = {
                    subjectId,
                    title,
                    number: parseInt(number),
                    duration: parseInt(duration),
                    description,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };

                if (chapterId) {
                    // Update existing chapter
                    db.ref(`chapters/${chapterId}`).update(chapterData)
                        .then(() => {
                            showToast('Chapter updated successfully', 'success');
                            chapterModal.classList.add('hidden');
                        })
                        .catch(error => {
                            console.error("Error updating chapter:", error);
                            showToast('Error updating chapter', 'error');
                        });
                } else {
                    // Add new chapter
                    db.ref('chapters').push(chapterData)
                        .then(() => {
                            showToast('Chapter added successfully', 'success');
                            chapterModal.classList.add('hidden');
                        })
                        .catch(error => {
                            console.error("Error adding chapter:", error);
                            showToast('Error adding chapter', 'error');
                        });
                }
            });

            // Lecture form submission
            document.getElementById('lecture-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const lectureId = document.getElementById('lecture-id').value;
                const chapterId = document.getElementById('lecture-chapter-id').value;
                const title = document.getElementById('lecture-title').value;
                const number = document.getElementById('lecture-number').value;
                const date = document.getElementById('lecture-date').value;
                const description = document.getElementById('lecture-description').value;
                const content = document.getElementById('lecture-content').value;

                const lectureData = {
                    chapterId,
                    title,
                    number: parseInt(number),
                    date,
                    description,
                    content,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };

                if (lectureId) {
                    // Update existing lecture
                    db.ref(`lectures/${lectureId}`).update(lectureData)
                        .then(() => {
                            showToast('Lecture updated successfully', 'success');
                            lectureModal.classList.add('hidden');
                        })
                        .catch(error => {
                            console.error("Error updating lecture:", error);
                            showToast('Error updating lecture', 'error');
                        });
                } else {
                    // Add new lecture
                    db.ref('lectures').push(lectureData)
                        .then(() => {
                            showToast('Lecture added successfully', 'success');
                            lectureModal.classList.add('hidden');
                        })
                        .catch(error => {
                            console.error("Error adding lecture:", error);
                            showToast('Error adding lecture', 'error');
                        });
                }
            });

            // DPP form submission
            document.getElementById('dpp-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const dppId = document.getElementById('dpp-id').value;
                const chapterId = document.getElementById('dpp-chapter-id').value;
                const title = document.getElementById('dpp-title').value;
                const number = document.getElementById('dpp-number').value;
                const dueDate = document.getElementById('dpp-date').value;
                const description = document.getElementById('dpp-description').value;
                const content = document.getElementById('dpp-content').value;
                const solution = document.getElementById('dpp-solution').value;

                const dppData = {
                    chapterId,
                    title,
                    number: parseInt(number),
                    dueDate,
                    description,
                    content,
                    solution,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };

                if (dppId) {
                    // Update existing DPP
                    db.ref(`dpps/${dppId}`).update(dppData)
                        .then(() => {
                            showToast('DPP updated successfully', 'success');
                            dppModal.classList.add('hidden');
                        })
                        .catch(error => {
                            console.error("Error updating DPP:", error);
                            showToast('Error updating DPP', 'error');
                        });
                } else {
                    // Add new DPP
                    db.ref('dpps').push(dppData)
                        .then(() => {
                            showToast('DPP added successfully', 'success');
                            dppModal.classList.add('hidden');
                        })
                        .catch(error => {
                            console.error("Error adding DPP:", error);
                            showToast('Error adding DPP', 'error');
                        });
                }
            });

            // Live class form submission
            document.getElementById('live-class-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const classId = document.getElementById('live-class-id').value;
                const batchId = document.getElementById('live-class-batch-id').value;
                const title = document.getElementById('live-class-title').value;
                const date = document.getElementById('live-class-date').value;
                const time = document.getElementById('live-class-time').value;
                const duration = document.getElementById('live-class-duration').value;
                const link = document.getElementById('live-class-link').value;
                const description = document.getElementById('live-class-description').value;

                const classData = {
                    batchId,
                    title,
                    date,
                    time,
                    duration: parseInt(duration),
                    link,
                    description,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };

                if (classId) {
                    // Update existing live class
                    db.ref(`liveClasses/${classId}`).update(classData)
                        .then(() => {
                            showToast('Live class updated successfully', 'success');
                            liveClassModal.classList.add('hidden');
                        })
                        .catch(error => {
                            console.error("Error updating live class:", error);
                            showToast('Error updating live class', 'error');
                        });
                } else {
                    // Add new live class
                    db.ref('liveClasses').push(classData)
                        .then(() => {
                            showToast('Live class scheduled successfully', 'success');
                            liveClassModal.classList.add('hidden');
                        })
                        .catch(error => {
                            console.error("Error scheduling live class:", error);
                            showToast('Error scheduling live class', 'error');
                        });
                }
            });

            // Admin dashboard tab switching
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.addEventListener('click', (e) => {
                    e.preventDefault();
                    document.querySelectorAll('.admin-section').forEach(section => {
                        section.classList.add('hidden');
                    });
                    document.querySelectorAll('.admin-tab').forEach(t => {
                        t.classList.remove('bg-indigo-50', 'border-indigo-500', 'text-indigo-700');
                        t.classList.add('border-transparent', 'text-gray-600', 'hover:bg-gray-50', 'hover:text-gray-900');
                    });

                    const sectionId = tab.id.replace('-tab', '-section');
                    document.getElementById(sectionId).classList.remove('hidden');
                    tab.classList.add('bg-indigo-50', 'border-indigo-500', 'text-indigo-700');
                    tab.classList.remove('border-transparent', 'text-gray-600', 'hover:bg-gray-50', 'hover:text-gray-900');

                    // Load appropriate data for the section
                    switch (sectionId) {
                        case 'admin-batches-section':
                            loadAdminBatches();
                            break;
                        case 'admin-subjects-section':
                            // Load batches for the select dropdown
                            const batchSelect = document.getElementById('subject-batch-select');
                            batchSelect.innerHTML = '<option value="">Select Batch</option>';

                            db.ref('batches').once('value')
                                .then(snapshot => {
                                    const batches = snapshot.val();
                                    if (batches) {
                                        for (const batchId in batches) {
                                            const option = document.createElement('option');
                                            option.value = batchId;
                                            option.textContent = batches[batchId].name;
                                            batchSelect.appendChild(option);
                                        }
                                    }
                                })
                                .catch(error => {
                                    console.error("Error loading batches for select:", error);
                                });

                            // Load subjects when batch is selected
                            batchSelect.addEventListener('change', () => {
                                const selectedBatchId = batchSelect.value;
                                if (selectedBatchId) {
                                    loadAdminSubjects(selectedBatchId);
                                } else {
                                    document.getElementById('subjects-admin-list').innerHTML = '';
                                }
                            });
                            break;
                        case 'admin-chapters-section':
                            // Load subjects for the select dropdown
                            const subjectSelect = document.getElementById('chapter-subject-select');
                            subjectSelect.innerHTML = '<option value="">Select Subject</option>';

                            db.ref('subjects').once('value')
                                .then(snapshot => {
                                    const subjects = snapshot.val();
                                    if (subjects) {
                                        for (const subjectId in subjects) {
                                            const option = document.createElement('option');
                                            option.value = subjectId;
                                            option.textContent = subjects[subjectId].name;
                                            subjectSelect.appendChild(option);
                                        }
                                    }
                                })
                                .catch(error => {
                                    console.error("Error loading subjects for select:", error);
                                });

                            // Load chapters when subject is selected
                            subjectSelect.addEventListener('change', () => {
                                const selectedSubjectId = subjectSelect.value;
                                if (selectedSubjectId) {
                                    loadAdminChapters(selectedSubjectId);
                                } else {
                                    document.getElementById('chapters-admin-list').innerHTML = '';
                                }
                            });
                            break;
                        case 'admin-resources-section':
                            // Load chapters for the select dropdown
                            const chapterSelect = document.getElementById('resource-chapter-select');
                            chapterSelect.innerHTML = '<option value="">Select Chapter</option>';

                            db.ref('chapters').once('value')
                                .then(snapshot => {
                                    const chapters = snapshot.val();
                                    if (chapters) {
                                        // Sort chapters by subject and number
                                        const sortedChapters = [];
                                        for (const chapterId in chapters) {
                                            sortedChapters.push({ id: chapterId, ...chapters[chapterId] });
                                        }

                                        // First get all subjects
                                        return db.ref('subjects').once('value')
                                            .then(subjectsSnapshot => {
                                                const subjects = subjectsSnapshot.val();
                                                if (!subjects) return;

                                                // Group chapters by subject
                                                const chaptersBySubject = {};
                                                sortedChapters.forEach(chapter => {
                                                    if (!chaptersBySubject[chapter.subjectId]) {
                                                        chaptersBySubject[chapter.subjectId] = [];
                                                    }
                                                    chaptersBySubject[chapter.subjectId].push(chapter);
                                                });

                                                // Sort chapters within each subject by number
                                                for (const subjectId in chaptersBySubject) {
                                                    chaptersBySubject[subjectId].sort((a, b) => a.number - b.number);
                                                }

                                                // Add options grouped by subject
                                                for (const subjectId in chaptersBySubject) {
                                                    const subject = subjects[subjectId];
                                                    if (subject) {
                                                        const optgroup = document.createElement('optgroup');
                                                        optgroup.label = subject.name;

                                                        chaptersBySubject[subjectId].forEach(chapter => {
                                                            const option = document.createElement('option');
                                                            option.value = chapter.id;
                                                            option.textContent = `Chapter ${chapter.number}: ${chapter.title}`;
                                                            optgroup.appendChild(option);
                                                        });

                                                        chapterSelect.appendChild(optgroup);
                                                    }
                                                }
                                            });
                                    }
                                })
                                .catch(error => {
                                    console.error("Error loading chapters for select:", error);
                                });

                            // Load lectures and DPPs when chapter is selected
                            chapterSelect.addEventListener('change', () => {
                                const selectedChapterId = chapterSelect.value;
                                if (selectedChapterId) {
                                    loadAdminLectures(selectedChapterId);
                                    loadAdminDpps(selectedChapterId);
                                } else {
                                    document.getElementById('lectures-admin-list').innerHTML = '';
                                    document.getElementById('dpps-admin-list').innerHTML = '';
                                }
                            });
                            break;
                        case 'admin-live-classes-section':
                            // Load batches for the select dropdown
                            const liveClassBatchSelect = document.getElementById('live-class-batch-select');
                            liveClassBatchSelect.innerHTML = '<option value="">Select Batch</option>';

                            db.ref('batches').once('value')
                                .then(snapshot => {
                                    const batches = snapshot.val();
                                    if (batches) {
                                        for (const batchId in batches) {
                                            const option = document.createElement('option');
                                            option.value = batchId;
                                            option.textContent = batches[batchId].name;
                                            liveClassBatchSelect.appendChild(option);
                                        }
                                    }
                                })
                                .catch(error => {
                                    console.error("Error loading batches for select:", error);
                                });

                            // Load live classes when batch is selected
                            liveClassBatchSelect.addEventListener('change', () => {
                                const selectedBatchId = liveClassBatchSelect.value;
                                if (selectedBatchId) {
                                    loadAdminLiveClasses(selectedBatchId);
                                } else {
                                    document.getElementById('live-classes-admin-list').innerHTML = '';
                                }
                            });
                            break;
                    }
                });
            });

            // Add batch button
            document.getElementById('add-batch-btn').addEventListener('click', addBatch);

            // Add subject button
            document.getElementById('add-subject-btn').addEventListener('click', addSubject);

            // Add chapter button
            document.getElementById('add-chapter-btn').addEventListener('click', addChapter);

            // Add lecture button
            document.getElementById('add-lecture-btn').addEventListener('click', addLecture);

            // Add DPP button
            document.getElementById('add-dpp-btn').addEventListener('click', addDpp);

            // Add live class button
            document.getElementById('add-live-class-btn').addEventListener('click', addLiveClass);

            // Enroll button on landing page
            document.getElementById('enroll-btn').addEventListener('click', () => {
                showAuthModal('signup');
            });

            // Login button on landing page
            document.getElementById('login-btn').addEventListener('click', () => {
                showAuthModal('login');
            });

            // Mobile menu toggle
            mobileMenuButton.addEventListener('click', () => {
                const mobileMenu = document.getElementById('mobile-menu');
                mobileMenu.classList.toggle('hidden');
            });

            // Mobile sidebar toggle
            mobileSidebarToggle.addEventListener('click', () => {
                const sidebar = document.querySelector('.md\\:flex-shrink-0');
                sidebar.classList.toggle('hidden');
            });

            // Update profile form submission
            document.getElementById('update-profile-form').addEventListener('submit', (e) => {
                e.preventDefault();
                updateProfile();
            });

            // Delete account button
            document.getElementById('delete-account-btn').addEventListener('click', () => {
                showDeleteConfirmation('account', currentUser.uid, () => {
                    deleteAccount();
                });
            });
        }
    </script>
</body>
</html>